(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();var Ae=class{rect;width;height;position=[0,0];screenWidth;screenHeight;constructor(n){this.screenWidth=n.screenWidth,this.screenHeight=n.screenHeight,n.cameraWidth&&n.cameraHeight&&(this.width=n.cameraWidth,this.height=n.cameraHeight,this.rect={left:(n.screenWidth-this.width)*.5,right:(n.screenWidth+this.width)*.5-1,top:(n.screenHeight-this.height)*.5,bottom:(n.screenHeight+this.height)*.5-1})}update(n,r){let[t,a]=n;if(!this.rect||!this.screenWidth||!this.screenHeight){this.position[0]=Math.floor(t/this.screenWidth)*this.screenWidth,this.position[1]=Math.floor(a/this.screenHeight)*this.screenHeight,this.clamp(r);return}let[o,l]=this.position,u=t-o,p=a-l;u<this.rect.left&&(this.position[0]-=this.rect.left-u),u>this.rect.right&&(this.position[0]+=u-this.rect.right),p<this.rect.top&&(this.position[1]-=this.rect.top-p),p>this.rect.bottom&&(this.position[1]+=p-this.rect.bottom),this.clamp(r)}isOnScreen(n){let[r,t]=n,a=r-this.position[0],o=t-this.position[1];return a>=0&&o>=0&&a<this.screenWidth&&o<this.screenHeight}reset(){this.position=[0,0]}clamp(n){let[r,t]=n;this.position[0]=Math.max(0,Math.min(this.position[0],r-this.screenWidth)),this.position[1]=Math.max(0,Math.min(this.position[1],t-this.screenHeight))}},Te=n=>new Ae(n),xe={player:{sprite:0},templates:{},map:`
		........
		........
		........
		........
		........
		........
		........
		........
	`,colors:["#212529","#f8f9fa","#ced4da","#228be6","#fa5252","#fcc419","#ff922b","#40c057","#f06595","#a52f01"],messageBackground:0,messageColor:1,dialogBackground:0,dialogColor:1,dialogBorder:1,screenWidth:8,screenHeight:8,cellWidth:8,cellHeight:8,background:1,volume:.5,controls:{LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",ACTION:["Enter","Space"]}},B=n=>n.trim().replace(/[ \t]/gm,"").split(/\n+/gm),Se=n=>{let r=n.length;return[Math.max(...n.map(t=>t.length)),r]},Pe=n=>{try{return new URL(n),!0}catch{return!1}},Ie=(...n)=>n.reduce((r,t)=>[r[0]+t[0],r[1]+t[1]],[0,0]),I=(...n)=>!n.some((r,t)=>{let a=n[t-1];return a?a[0]!==r[0]||a[1]!==r[1]:!1}),W=n=>{let r=0,t=n,a=new Map;return{subscribe:o=>{let l=r;return r++,a.set(l,o),o(t),()=>{a.delete(l)}},set:o=>{t=o,a.forEach(l=>{l(t)})},silentSet:o=>{t=o},get:()=>t,update:o=>{t=o(t),a.forEach(l=>{l(t)})},silentUpdate:o=>{t=o(t)}}},Ee=(n,r)=>{let t;return(...a)=>{let o;return t&&clearTimeout(t),t=setTimeout(()=>{o=n(...a)},r),o}},ke=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[24,60,60,24,24,0,24,0],[54,54,0,0,0,0,0,0],[54,54,127,54,127,54,54,0],[12,62,3,30,48,31,12,0],[0,99,51,24,12,102,99,0],[28,54,28,110,59,51,110,0],[6,6,3,0,0,0,0,0],[24,12,6,6,6,12,24,0],[6,12,24,24,24,12,6,0],[0,102,60,255,60,102,0,0],[0,12,12,63,12,12,0,0],[0,0,0,0,0,12,12,6],[0,0,0,63,0,0,0,0],[0,0,0,0,0,12,12,0],[96,48,24,12,6,3,1,0],[62,99,115,123,111,103,62,0],[12,14,12,12,12,12,63,0],[30,51,48,28,6,51,63,0],[30,51,48,28,48,51,30,0],[56,60,54,51,127,48,120,0],[63,3,31,48,48,51,30,0],[28,6,3,31,51,51,30,0],[63,51,48,24,12,12,12,0],[30,51,51,30,51,51,30,0],[30,51,51,62,48,24,14,0],[0,12,12,0,0,12,12,0],[0,12,12,0,0,12,12,6],[24,12,6,3,6,12,24,0],[0,0,63,0,0,63,0,0],[6,12,24,48,24,12,6,0],[30,51,48,24,12,0,12,0],[62,99,123,123,123,3,30,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[60,102,3,3,3,102,60,0],[31,54,102,102,102,54,31,0],[127,70,22,30,22,70,127,0],[127,70,22,30,22,6,15,0],[60,102,3,3,115,102,124,0],[51,51,51,63,51,51,51,0],[30,12,12,12,12,12,30,0],[120,48,48,48,51,51,30,0],[103,102,54,30,54,102,103,0],[15,6,6,6,70,102,127,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[28,54,99,99,99,54,28,0],[63,102,102,62,6,6,15,0],[30,51,51,51,59,30,56,0],[63,102,102,62,54,102,103,0],[30,51,7,14,56,51,30,0],[63,45,12,12,12,12,30,0],[51,51,51,51,51,51,63,0],[51,51,51,51,51,30,12,0],[99,99,99,107,127,119,99,0],[99,99,54,28,28,54,99,0],[51,51,51,30,12,12,30,0],[127,99,49,24,76,102,127,0],[30,6,6,6,6,6,30,0],[3,6,12,24,48,96,64,0],[30,24,24,24,24,24,30,0],[8,28,54,99,0,0,0,0],[0,0,0,0,0,0,0,255],[12,12,24,0,0,0,0,0],[0,0,30,48,62,51,110,0],[7,6,6,62,102,102,59,0],[0,0,30,51,3,51,30,0],[56,48,48,62,51,51,110,0],[0,0,30,51,63,3,30,0],[28,54,6,15,6,6,15,0],[0,0,110,51,51,62,48,31],[7,6,54,110,102,102,103,0],[12,0,14,12,12,12,30,0],[48,0,48,48,48,51,51,30],[7,6,102,54,30,54,103,0],[14,12,12,12,12,12,30,0],[0,0,51,127,127,107,99,0],[0,0,31,51,51,51,51,0],[0,0,30,51,51,51,30,0],[0,0,59,102,102,62,6,15],[0,0,110,51,51,62,48,120],[0,0,59,110,102,6,15,0],[0,0,62,3,30,48,31,0],[8,12,62,12,12,44,24,0],[0,0,51,51,51,51,110,0],[0,0,51,51,51,30,12,0],[0,0,99,107,127,127,54,0],[0,0,99,54,28,54,99,0],[0,0,51,51,51,62,48,31],[0,0,63,25,12,38,63,0],[56,12,12,7,12,12,56,0],[24,24,24,0,24,24,24,0],[7,12,12,56,12,12,7,0],[110,59,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],Me=[[0,0,0,0,0,0,0,0],[24,24,0,24,24,24,24,0],[24,24,126,3,3,126,24,24],[28,54,38,15,6,103,63,0],[0,0,99,62,54,62,99,0],[51,51,30,63,12,63,12,12],[24,24,24,0,24,24,24,0],[124,198,28,54,54,28,51,30],[51,0,0,0,0,0,0,0],[60,66,153,133,133,153,66,60],[60,54,54,124,0,0,0,0],[0,204,102,51,102,204,0,0],[0,0,0,63,48,48,0,0],[0,0,0,0,0,0,0,0],[60,66,157,165,157,165,66,60],[126,0,0,0,0,0,0,0],[28,54,54,28,0,0,0,0],[24,24,126,24,24,0,126,0],[28,48,24,12,60,0,0,0],[28,48,24,48,28,0,0,0],[24,12,0,0,0,0,0,0],[0,0,102,102,102,62,6,3],[254,219,219,222,216,216,216,0],[0,0,0,24,24,0,0,0],[0,0,0,0,0,24,48,30],[8,12,8,28,0,0,0,0],[28,54,54,28,0,0,0,0],[0,51,102,204,102,51,0,0],[195,99,51,189,236,246,243,3],[195,99,51,123,204,102,51,240],[3,196,99,180,219,172,230,128],[12,0,12,6,3,51,30,0],[7,0,28,54,99,127,99,0],[112,0,28,54,99,127,99,0],[28,54,0,62,99,127,99,0],[110,59,0,62,99,127,99,0],[99,28,54,99,127,99,99,0],[12,12,0,30,51,63,51,0],[124,54,51,127,51,51,115,0],[30,51,3,51,30,24,48,30],[7,0,63,6,30,6,63,0],[56,0,63,6,30,6,63,0],[12,18,63,6,30,6,63,0],[54,0,63,6,30,6,63,0],[7,0,30,12,12,12,30,0],[56,0,30,12,12,12,30,0],[12,18,0,30,12,12,30,0],[51,0,30,12,12,12,30,0],[63,102,111,111,102,102,63,0],[63,0,51,55,63,59,51,0],[14,0,24,60,102,60,24,0],[112,0,24,60,102,60,24,0],[60,102,24,60,102,60,24,0],[110,59,0,62,99,99,62,0],[195,24,60,102,102,60,24,0],[0,54,28,8,28,54,0,0],[92,54,115,123,111,54,29,0],[14,0,102,102,102,102,60,0],[112,0,102,102,102,102,60,0],[60,102,0,102,102,102,60,0],[51,0,51,51,51,51,30,0],[112,0,102,102,60,24,24,0],[15,6,62,102,102,62,6,15],[0,30,51,31,51,31,3,3],[7,0,30,48,62,51,126,0],[56,0,30,48,62,51,126,0],[126,195,60,96,124,102,252,0],[110,59,30,48,62,51,126,0],[51,0,30,48,62,51,126,0],[12,12,30,48,62,51,126,0],[0,0,254,48,254,51,254,0],[0,0,30,3,3,30,48,28],[7,0,30,51,63,3,30,0],[56,0,30,51,63,3,30,0],[126,195,60,102,126,6,60,0],[51,0,30,51,63,3,30,0],[7,0,14,12,12,12,30,0],[28,0,14,12,12,12,30,0],[62,99,28,24,24,24,60,0],[51,0,14,12,12,12,30,0],[27,14,27,48,62,51,30,0],[0,31,0,31,51,51,51,0],[0,7,0,30,51,51,30,0],[0,56,0,30,51,51,30,0],[30,51,0,30,51,51,30,0],[110,59,0,30,51,51,30,0],[0,51,0,30,51,51,30,0],[24,24,0,126,0,24,24,0],[0,96,60,118,126,110,60,6],[0,7,0,51,51,51,126,0],[0,56,0,51,51,51,126,0],[30,51,0,51,51,51,126,0],[0,51,0,51,51,51,126,0],[0,56,0,51,51,62,48,31],[0,0,6,62,102,62,6,0],[0,51,0,51,51,62,48,31]],Oe=[[45,0,12,12,12,44,24,0],[12,30,51,51,63,51,51,0],[63,102,102,62,102,102,63,0],[63,51,3,3,3,3,3,0],[8,28,28,54,54,99,127,0],[127,70,22,30,22,70,127,0],[127,99,49,24,76,102,127,0],[51,51,51,63,51,51,51,0],[28,54,99,127,99,54,28,0],[30,12,12,12,12,12,30,0],[103,102,54,30,54,102,103,0],[8,28,28,54,54,99,99,0],[99,119,127,127,107,99,99,0],[99,103,111,123,115,99,99,0],[127,99,0,62,0,99,127,0],[28,54,99,99,99,54,28,0],[127,54,54,54,54,54,54,0],[63,102,102,62,6,6,15,0],[0,1,2,4,79,144,160,64],[127,99,6,12,6,99,127,0],[63,45,12,12,12,12,30,0],[51,51,51,30,12,12,30,0],[24,126,219,219,219,126,24,0],[99,99,54,28,54,99,99,0],[219,219,219,126,24,24,60,0],[62,99,99,99,54,54,119,0],[51,0,30,12,12,12,30,0],[51,0,51,51,30,12,30,0],[112,0,110,59,19,59,110,0],[56,0,30,3,14,3,30,0],[56,0,31,51,51,51,51,48],[56,0,12,12,12,44,24,0],[45,0,51,51,51,51,30,0],[0,0,110,59,19,59,110,0],[0,30,51,31,51,31,3,3],[0,0,51,51,30,12,12,0],[56,12,24,62,51,51,30,0],[0,0,30,3,14,3,30,0],[0,63,6,3,3,30,48,28],[0,0,31,51,51,51,51,48],[0,0,30,51,63,51,30,0],[0,0,12,12,12,44,24,0],[0,0,51,27,15,27,51,0],[0,3,6,12,28,54,99,0],[0,0,102,102,102,62,6,3],[0,0,51,51,51,30,12,0],[30,3,14,3,3,30,48,28],[0,0,30,51,51,51,30,0],[0,0,127,54,54,54,54,0],[0,0,60,102,102,54,6,6],[0,0,62,3,3,30,48,28],[0,0,126,27,27,27,14,0],[0,0,126,24,24,88,48,0],[0,0,51,51,51,51,30,0],[0,0,118,219,219,126,24,0],[0,99,54,28,28,54,99,0],[0,0,219,219,219,126,24,0],[0,0,54,99,107,127,54,0]],De=[[0,0,0,0,0,0,0,0],[4,63,4,60,86,77,38,0],[4,63,4,60,86,77,38,0],[0,0,0,17,33,37,2,0],[0,1,17,33,33,37,2,0],[0,28,0,28,34,32,24,0],[60,0,60,66,64,32,24,0],[28,0,62,16,56,36,98,0],[28,0,62,16,56,36,98,0],[36,79,4,60,70,69,34,0],[36,79,4,60,70,69,34,0],[4,36,79,84,82,18,9,0],[68,36,15,84,82,82,9,0],[8,31,8,63,28,2,60,0],[68,47,4,31,14,1,30,0],[16,8,4,2,4,8,16,0],[40,68,18,33,2,4,8,0],[0,34,121,33,33,34,16,0],[64,34,17,61,17,18,8,0],[0,0,60,0,2,2,60,0],[32,64,22,32,1,1,14,0],[16,126,16,60,2,2,28,0],[36,79,20,46,1,1,14,0],[0,2,2,2,66,34,28,0],[32,66,18,34,2,34,28,0],[16,126,24,20,24,16,12,0],[68,47,6,5,6,4,3,0],[32,114,47,34,26,2,28,0],[128,80,58,23,26,2,28,0],[30,8,4,127,8,4,56,0],[79,36,2,127,8,4,56,0],[2,15,2,114,2,9,113,0],[66,47,2,114,2,9,113,0],[8,126,8,60,64,64,56,0],[68,47,4,30,32,32,28,0],[0,0,0,28,34,32,28,0],[0,28,34,65,64,32,28,0],[64,32,30,33,32,32,28,0],[0,62,8,4,4,4,56,0],[0,62,72,36,4,4,56,0],[4,4,8,60,2,2,60,0],[68,36,8,60,2,2,60,0],[50,2,39,34,114,41,17,0],[0,2,122,2,10,114,2,0],[8,9,62,75,101,85,34,0],[4,7,52,76,102,84,36,0],[0,0,60,74,73,69,34,0],[0,34,122,34,114,42,18,0],[128,81,29,17,57,21,9,0],[64,177,93,17,57,21,9,0],[0,0,19,50,81,17,14,0],[64,32,3,50,81,17,14,0],[64,160,67,50,81,17,14,0],[28,0,8,42,73,16,12,0],[76,32,8,42,73,16,12,0],[76,160,72,10,41,72,12,0],[0,0,4,10,17,32,64,0],[32,64,20,42,17,32,64,0],[32,80,36,10,17,32,64,0],[125,17,125,17,57,85,9,0],[157,81,29,17,57,85,9,0],[93,177,93,17,57,85,9,0],[126,8,62,8,28,42,4,0],[0,7,36,36,126,37,18,0],[4,15,100,6,5,38,60,0],[0,9,61,74,75,69,42,0],[2,15,2,15,98,66,60,0],[0,0,18,31,34,18,4,0],[0,18,63,66,66,52,4,0],[0,0,17,61,83,57,17,0],[0,17,61,83,81,57,17,0],[0,8,56,8,28,42,4,0],[8,8,56,8,28,42,4,0],[30,0,2,58,70,66,48,0],[0,32,34,34,42,36,16,0],[31,8,60,66,73,84,56,0],[4,7,4,12,22,85,36,0],[63,16,8,60,66,65,48,0],[0,0,8,14,56,76,42,0],[4,7,4,60,70,69,36,0],[14,8,60,74,105,85,50,0],[6,60,66,57,4,54,73,0],[4,15,4,110,17,8,112,0],[8,8,4,12,86,82,33,0],[64,46,0,60,66,64,56,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[64,128,32,64,0,0,0,0],[64,160,64,0,0,0,0,0],[0,0,8,8,16,48,12,0],[32,64,20,36,8,24,6,0],[0,0,0,0,0,0,0,0]],Le=[[255,255,255,255,0,0,0,0],[0,0,0,0,0,0,0,255],[0,0,0,0,0,0,255,255],[0,0,0,0,0,255,255,255],[0,0,0,0,255,255,255,255],[0,0,0,255,255,255,255,255],[0,0,255,255,255,255,255,255],[0,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255],[127,127,127,127,127,127,127,127],[63,63,63,63,63,63,63,63],[31,31,31,31,31,31,31,31],[15,15,15,15,15,15,15,15],[7,7,7,7,7,7,7,7],[3,3,3,3,3,3,3,3],[1,1,1,1,1,1,1,1],[240,240,240,240,240,240,240,240],[85,0,170,0,85,0,170,0],[85,170,85,170,85,170,85,170],[255,170,255,85,255,170,255,85],[255,0,0,0,0,0,0,0],[128,128,128,128,128,128,128,128],[0,0,0,0,15,15,15,15],[0,0,0,0,240,240,240,240],[15,15,15,15,0,0,0,0],[15,15,15,15,255,255,255,255],[15,15,15,15,240,240,240,240],[255,255,255,255,15,15,15,15],[255,255,255,255,240,240,240,240],[240,240,240,240,0,0,0,0],[240,240,240,240,15,15,15,15],[240,240,240,240,255,255,255,255]],Ce=[{start:0,characters:ke},{start:160,characters:Me},{start:912,characters:Oe},{start:12352,characters:De},{start:9600,characters:Le}],ne={"~":"waveY",_:"waveX","%":"shake","=":"shakeX","^":"shakeY","°":"blink"},C=8,J=class K{#t;#n;#r;#e;#i;constructor(r,t,a){this.#r=r,this.#e=t,this.#i=a,this.#t=[{pattern:"\\\\.",type:"char",process:o=>o.charAt(1)},{pattern:this.#s(r),type:"char"},{pattern:"<\\d>",type:"color",process:o=>o.charAt(1)},{pattern:Object.keys(ne).map(this.#s).join("|"),type:"effect",process:o=>ne[o]},{pattern:"[^\\n\\r\\t]",type:"char"}],this.#n=new RegExp(this.#t.map(o=>`(${o.pattern})`).join("|"),"g")}parseText(r,t){let a=this.#a(r),o=this.#l(a);return this.#o(o,t)}draw(r,t,a,o,l){for(let u=0;u<t.length;u++){let p=t[u];if(p===void 0)continue;let m=a+u*C,_=o,y=p.color?this.#i[p.color]:null;switch(y?r.fillStyle=y:r.fillStyle=this.#e,p.effect){case"waveY":_+=Math.floor(Math.sin(l*.01+u)*3);break;case"waveX":m+=Math.floor(Math.sin(l*.01+u)*2);break;case"shake":m+=Math.floor((Math.random()-.5)*2),_+=Math.floor((Math.random()-.5)*2);break;case"shakeX":m+=Math.floor((Math.random()-.5)*2);break;case"shakeY":_+=Math.floor((Math.random()-.5)*2);break;case"blink":Math.sin(l*.015)>0&&(r.fillStyle="transparent");break}K.#u(r,p.value,m,_)}}#a(r){let t=r.matchAll(this.#n),a=[];for(let o of t){o.shift();let l=o.findIndex(_=>_!==void 0),{type:u,process:p}=this.#t[l],m=p?p(o[l]):o[l];a.push({value:m,type:u})}return a}#l(r){let t=[],a=[],o=[];for(let l=0;l<r.length;l++){let u=r[l];if(!u)continue;let{type:p,value:m}=u;if(p==="char"){let _=a[a.length-1],y=o[o.length-1];t.push({value:m,color:_,effect:y});continue}if(u.type==="color"){let _=a.lastIndexOf(parseInt(m));_!==-1?a.splice(_,1):a.push(parseInt(m));continue}if(u.type==="effect"){let _=o.lastIndexOf(m);_!==-1?o.splice(_,1):o.push(m)}}return t}#o(r,t){let a=[];e:for(;r.length>0;){let o=r.findIndex((l,u)=>l.value===this.#r&&u<t);if(o!==-1){a.push(r.splice(0,o)),r.splice(0,1);continue}else if(r.length<=t){a.push(r),r=[];continue}for(let l=t;l>=0;l--)if(r[l]?.value===" "){a.push(r.splice(0,l)),r.splice(0,1);continue e}a.push(r.splice(0,t))}return r.length>0&&a.push(r),a}#s(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static#u(r,t,a,o){let l=t.charCodeAt(0),u=this.#c(l);if(u)for(let p=0;p<C;p++){let m=u[p];if(m!==void 0)for(let _=0;_<C;_++)m&1<<_&&r.fillRect(a+_,o+p,1,1)}}static text(r,t,a,o){for(let l=0;l<t.length;l++){let u=t.charAt(l);K.#u(r,u,a+l*C,o)}}static#c(r){let t=Ce.find(a=>r>=a.start&&r<a.start+a.characters.length);return t?t.characters[r-t.start]:null}},q=384,Re=30,k=2,ie=28,re=10,ae=8,oe=12,He=8,R=2,Fe=class{#t;#n;#r;#e;#i;#a=[];#l=0;#o;#s=0;#u;isOpen=!1;#c;#f;#m;#p;#d;#h;#_;#v;constructor(n){this.#c=n.colors,this.#f=this.#b(n.dialogBackground),this.#m=this.#b(n.dialogColor),this.#p=this.#b(n.dialogBorder),this.#t=document.createElement("canvas"),this.#t.style.setProperty("position","absolute"),this.#t.style.setProperty("box-sizing","border-box"),this.#t.style.setProperty("display","none"),this.#t.style.setProperty("image-rendering","pixelated"),this.#n=this.#t.getContext("2d"),this.#t.width=q,this.#t.height=q,this.#t.classList.add("odyc-dialog-canvas"),this.#g(),document.body.append(this.#t),window.addEventListener("resize",this.#g),this.#h=ie*8+ae*2,this.#d=k*He+oe*2+re*(k-1),this.#_=(this.#t.width-this.#h)*.5,this.#v=this.#t.height-this.#d-Math.floor(q/15),this.#u=new J("|",this.#m,n.colors)}async open(n){if(!(n.length<=0))return this.isOpen=!0,this.#t.style.setProperty("display","block"),this.#e=this.#u.parseText(n,ie),this.#i=this.#e.shift(),this.#a=new Array(k).fill(null).map(r=>[]),this.#o=requestAnimationFrame(this.#y),new Promise(r=>{this.#r=()=>r()})}next(){this.#i&&this.#i.length>0||this.#l<k-1||(this.#i=this.#e?.shift(),this.#l=0,this.#a=this.#a.map(()=>[]),this.#i===void 0&&this.#w())}#y=n=>{if(this.#o=requestAnimationFrame(this.#y),n-this.#s<Re)return;this.#s=n,this.#i?.length===0&&this.#l<k-1&&(this.#l++,this.#i=this.#e?.shift());let r=this.#i?.shift();r&&this.#a[this.#l]?.push(r),this.#A(n)};#w(){this.isOpen=!1,this.#t.style.setProperty("display","none"),this.#l=0,this.#r?.(),this.#o&&cancelAnimationFrame(this.#o)}#g=()=>{let n=Math.min(window.innerWidth,window.innerHeight),r=(window.innerWidth-n)*.5,t=(window.innerHeight-n)*.5;this.#t.style.setProperty("width",`${n}px`),this.#t.style.setProperty("height",`${n}px`),this.#t.style.setProperty("left",`${r}px`),this.#t.style.setProperty("top",`${t}px`)};#A=n=>{this.#T();let r=this.#_+ae;for(let t=0;t<this.#a.length;t++){let a=this.#a[t];if(!a)continue;let o=this.#v+oe+8*t+t*re;this.#u.draw(this.#n,a,r,o,n)}};#T(){this.#n.clearRect(0,0,this.#t.width,this.#t.height),this.#n.fillStyle=this.#p,this.#n.fillRect(this.#_-R,this.#v-R,this.#h+R*2,this.#d+R*2),this.#n.fillStyle=this.#f,this.#n.fillRect(this.#_,this.#v,this.#h,this.#d)}#b(n){return typeof n=="string"?n:this.#c[n]??"black"}},Be=n=>new Fe(n),We=({gameState:n,messageBox:r,camera:t})=>({play:async(...a)=>{a.length&&r.open(a),t.reset(),n.player.restoreSavedState(),n.actors.reset()}}),se=`attribute vec2 a_position;
varying vec2 v_texCoords;
void main() {
    gl_Position = vec4(a_position, 0.0, 1.0);
    v_texCoords = a_position * vec2(0.5, -0.5) + 0.5;
}
`,le=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;

void main() {
    gl_FragColor = texture2D(u_texture, v_texCoords);
}
`,Ve=`precision mediump float;
varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;
uniform float u_sideCount;
uniform float u_scale;
uniform float u_rotation;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

void main() {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI + u_rotation * TWO_PI;
    float r = TWO_PI / float(u_sideCount);

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    float threshold = 1.0 - step(u_scale, d);
    gl_FragColor = texture2D(u_texture, v_texCoords) * threshold;
}
`,Ge=`precision mediump float;
varying vec2 v_texCoords;

uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_warp;
uniform float u_lineWidth;
uniform float u_lineIntensity;
uniform float u_lineCount;

void main() {
    vec2 fragCoord = v_texCoords * u_size;
    vec2 uv = v_texCoords;

    vec2 dc = abs(0.5 - uv);
    dc *= dc;

    uv.x -= 0.5;
    uv.x *= 1.0 + dc.y * (0.3 * u_warp);
    uv.x += 0.5;

    uv.y -= 0.5;
    uv.y *= 1.0 + dc.x * (0.4 * u_warp);
    uv.y += 0.5;

    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        gl_FragColor = vec4(0.0);
    } else {
        float dist = abs(fract(uv.y * u_lineCount) - 0.5);
        float scanLine = min(step(u_lineWidth * .5, dist) + (1. - u_lineIntensity), 1.);

        vec3 color = texture2D(u_texture, uv).rgb;
        gl_FragColor = vec4(color * scanLine, 1.0);
    }
}
`,qe=`precision mediump float;

varying vec2 v_texCoords;
uniform sampler2D u_texture;
uniform vec2 u_size;

uniform float u_scale;
uniform float u_intensity;

#define PI 3.14159265359
#define TWO_PI 6.28318530718
#define CELL_SIZE 24.

float mosaic(float scale) {
    float d = 0.0;
    vec2 uv = fract(v_texCoords * (u_size / CELL_SIZE));
    vec2 st = uv * 2. - 1.;

    float a = atan(st.x, st.y) + PI;
    float r = TWO_PI / 4.;

    d = cos(floor(.5 + a / r) * r - a) * length(st);

    return 1.0 - step(scale, d);
}

vec3 blur() {
    vec2 radius = CELL_SIZE / u_size;
    vec3 blur = vec3(0);
    float count = 0.;

    for (int j = 0; j < 16; j++) {
        float d = float(j) * TWO_PI / 16.;
        vec2 offset = vec2(cos(d), sin(d)) / (u_size / CELL_SIZE);
        blur += texture2D(u_texture, v_texCoords + offset).rgb;
        count++;
    }

    return blur / count;
}

void main() {
    vec3 color = texture2D(u_texture, v_texCoords).rgb;

    vec3 with_blur = mix(color, blur(), u_intensity);
    gl_FragColor = vec4(max(color, with_blur), 1.) * mosaic(u_scale);
}
`,N={fractal:{fragment:Ve,settings:{sideCount:12,scale:.9,rotation:0}},crt:{fragment:Ge,settings:{warp:.7,lineIntensity:.2,lineWidth:.6,lineCount:85}},neon:{fragment:qe,settings:{scale:.75,intensity:.8}}},Ne=n=>{if("name"in n){let r=Object.assign({},N[n.name].settings,n.settings);return{vertex:N[n.name].vertex??se,fragment:N[n.name].fragment??le,settings:r}}return{vertex:n.vertex??se,fragment:n.fragment??le,settings:n.settings}},Xe=class{canvas;#t;#n={};#r;#e;#i;#a;#l;#o=new Map;#s;constructor(n,r){if(this.#t=Ne(r),this.#t.settings)for(let l in this.#t.settings){let u=this.#t.settings?.[l];this.#n[l]=Array.isArray(u)?[...u]:u}this.#r=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.#r.width,this.canvas.height=this.#r.height,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","pixelated"),this.canvas.classList.add("odyc-filter-canvas"),window.addEventListener("resize",this.#u);let t=this.canvas.getContext("webgl",{preserveDrawingBuffer:!0});if(!t)throw new Error("WebGL not supported");this.#e=t;let a=this.#c(this.#e.VERTEX_SHADER,this.#t.vertex),o=this.#c(this.#e.FRAGMENT_SHADER,this.#t.fragment);this.#i=this.#f(a,o),this.#e.useProgram(this.#i),this.#s=this.#e.getAttribLocation(this.#i,"a_position"),this.#l=this.#m(),this.#a=this.#p(),this.#u(),this.#r.after(this.canvas),this.#r.style.setProperty("display","none")}render(){this.#_("size",[this.canvas.width,this.canvas.height]),this.#n&&Object.entries(this.#n).forEach(([n,r])=>{this.#_(n,r)}),this.#e.viewport(0,0,this.canvas.width,this.canvas.height),this.#e.clearColor(0,0,0,1),this.#e.clear(this.#e.COLOR_BUFFER_BIT),this.#d(),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,this.#l),this.#e.enableVertexAttribArray(this.#s),this.#e.vertexAttribPointer(this.#s,2,this.#e.FLOAT,!1,0,0),this.#e.drawArrays(this.#e.TRIANGLES,0,6)}setUniforms(n){for(let[r,t]of Object.entries(n))this.#n[r]=Array.isArray(t)?[...t]:t}#u=()=>{let n=this.canvas.width<this.canvas.height?"vertical":"horizontal",r=Math.min(window.innerWidth,window.innerHeight),t=n==="horizontal"?r:r/this.canvas.height*this.canvas.width,a=n==="vertical"?r:r/this.canvas.width*this.canvas.height,o=(window.innerWidth-t)*.5,l=(window.innerHeight-a)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${a}px`),this.canvas.style.setProperty("left",`${o}px`),this.canvas.style.setProperty("top",`${l}px`),this.render()};#c(n,r){let t=this.#e.createShader(n);if(this.#e.shaderSource(t,r),this.#e.compileShader(t),!this.#e.getShaderParameter(t,this.#e.COMPILE_STATUS)){let a=this.#e.getShaderInfoLog(t);throw this.#e.deleteShader(t),new Error(`Shader compilation failed:
${a}`)}return t}#f(n,r){let t=this.#e.createProgram();if(this.#e.attachShader(t,n),this.#e.attachShader(t,r),this.#e.linkProgram(t),!this.#e.getProgramParameter(t,this.#e.LINK_STATUS)){let a=this.#e.getProgramInfoLog(t);throw this.#e.deleteProgram(t),new Error(`Program link failed:
${a}`)}if(this.#e.validateProgram(t),!this.#e.getProgramParameter(t,this.#e.VALIDATE_STATUS))throw new Error("validating program"+this.#e.getProgramInfoLog(t));return t}#m(){let n=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),r=this.#e.createBuffer();if(this.#e.bindBuffer(this.#e.ARRAY_BUFFER,r),this.#e.bufferData(this.#e.ARRAY_BUFFER,n,this.#e.STATIC_DRAW),this.#e.bindBuffer(this.#e.ARRAY_BUFFER,null),!r)throw new Error("failed to create quad");return r}#p(){let n=this.#e.createTexture();if(this.#e.bindTexture(this.#e.TEXTURE_2D,n),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_S,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_WRAP_T,this.#e.CLAMP_TO_EDGE),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MIN_FILTER,this.#e.NEAREST),this.#e.texParameteri(this.#e.TEXTURE_2D,this.#e.TEXTURE_MAG_FILTER,this.#e.NEAREST),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#r),this.#e.bindTexture(this.#e.TEXTURE_2D,null),!n)throw new Error("failed to create texture");return n}#d(){this.#e.bindTexture(this.#e.TEXTURE_2D,this.#a),this.#e.texImage2D(this.#e.TEXTURE_2D,0,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,this.#r)}#h(n){let r=`u_${n}`;if(this.#o.has(r))return this.#o.get(r);let t=this.#e.getUniformLocation(this.#i,r);return t&&this.#o.set(r,t),t}#_(n,r){let t=this.#h(n);if(t){if(typeof r=="number"&&(r=[r]),r.length<1||r.length>4)throw new Error("setUniform supports 1–4 float values");switch(r.length){case 1:this.#e.uniform1f(t,r[0]);break;case 2:this.#e.uniform2f(t,r[0],r[1]);break;case 3:this.#e.uniform3f(t,r[0],r[1],r[2]);break;case 4:this.#e.uniform4f(t,r[0],r[1],r[2],r[3]);break}}}},Ue=(n,r)=>r?new Xe(n,r):null,$e=(n,r,t,a,o,l)=>({player:n.player.playerProxy,getCell:n.actors.getCell,addToCell:n.actors.addToCell,setCell:n.actors.setCell,getAll:n.actors.getAll,setAll:n.actors.setAll,openDialog:u=>r.open(u),prompt:(...u)=>t.open(...u),openMenu:u=>t.openMenu(u),openMessage:(...u)=>l.open(u),playSound:(...u)=>a.play(...u),end:(...u)=>o.play(...u),loadMap:(u,p)=>{p&&(n.player.playerProxy.position=[...p]),n.mapStore.store.set(u),n.player.saveCurrentState()},updateFilter:u=>{n.uniformsStore.update(p=>{for(let[m,_]of Object.entries(u))p[m]=Array.isArray(_)?[..._]:_;return p})},get width(){return n.mapStore.getDimensions()[0]},get height(){return n.mapStore.getDimensions()[1]}}),Ye=class{gameState;soundPlayer;dialog;ender;constructor(n){this.gameState=n.gameState,this.soundPlayer=n.soundPlayer,this.dialog=n.dialog,this.ender=n.ender}async update(n){let r=this.gameState.player.playerProxy.position,t=Ie(r,je[n]);if(!this.isCellOnScreen(t))return;let a=this.gameState.actors.getCell(...r),o=this.gameState.actors.getCell(...t),l=o.sound;if(l){let p=Array.isArray(l)?l:[l];this.soundPlayer.play(...p)}let u=o.end;if(o.solid){let p=o.dialog;p&&await this.dialog.open(p),await this.gameState.actors.getEvent(...t,"onCollide")?.(o)}else if(this.gameState.actors.getEvent(...r,"onLeave")?.(a),I(r,this.gameState.player.playerProxy.position)&&(this.gameState.player.playerProxy.position=t),o){let p=o?.dialog;p?this.dialog.open(p).then(()=>{this.gameState.actors.getEvent(...t,"onEnter")?.(o)}):this.gameState.actors.getEvent(...t,"onEnter")?.(o)}u&&(typeof u=="string"?await this.ender.play(u):typeof u=="boolean"&&u?this.ender.play():await this.ender.play(...u))}isCellOnScreen([n,r]){return n>=0&&r>=0&&n<this.gameState.mapStore.getDimensions()[0]&&r<this.gameState.mapStore.getDimensions()[1]}getActorOnCell(n,r){return n.find(({position:t})=>t[0]===r[0]&&t[1]===r[1])}},je={LEFT:[-1,0],RIGHT:[1,0],UP:[0,-1],DOWN:[0,1],ACTION:[0,0]},Ze=n=>new Ye(n),ue=(n,r)=>{let t=[];r.subscribe(l=>t=l);let a=()=>t.find(l=>I(l.position,n)),o=(l,u)=>{r.update(p=>{for(let m=0;m<p.length;m++){let _=p[m];!_||p[m]===void 0||!I(_.position,n)||(p[m][l]=u)}return p})};return{get sprite(){return a()?.sprite??null},set sprite(l){o("sprite",l)},get solid(){return a()?.solid??!1},set solid(l){o("solid",l)},get sound(){return a()?.sound??null},set sound(l){o("sound",l)},get position(){return a()?.position??[-1,-1]},get dialog(){return a()?.dialog??null},set dialog(l){o("dialog",l)},get visible(){return a()?.visible??!1},set visible(l){o("visible",l)},get end(){return a()?.end??null},set end(l){o("end",l)},get symbol(){return a()?.symbol??null},remove:()=>{r.update(l=>l.filter(u=>!I(u.position,n)))}}},Qe=(n,r)=>{let t=n.templates,a=[],o=W(a);return o.subscribe(l=>{a=l}),r.store.subscribe(l=>{o.set(ce(B(l),t))}),{getCell:(l,u)=>ue([l,u],o),setCell:(l,u,p)=>{o.update(m=>{for(let _=0;_<m.length;_++){let y=m[_];if(!y||!y.position||!I(y.position,[l,u]))continue;let e=Object.assign({},y,p);m[_]=e}return m})},getAll:l=>a.filter(u=>u.symbol===l).map(u=>ue(u.position,o)),setAll:(l,u)=>{o.update(p=>{for(let m=0;m<p.length;m++){let _=p[m];if(_?.symbol!==l)continue;let y=Object.assign({},_,u);p[m]=y}return p})},addToCell:(l,u,p)=>{let m=ve(t,p);m&&o.update(_=>[..._.filter(y=>!I([l,u],y.position)),me(l,u,p,m)])},getEvent:(l,u,p)=>o.get().find(m=>m.position[0]===l&&m.position[1]===u)?.[p],reset:()=>o.set(ce(B(r.store.get()),t)),_store:o}},ce=(n,r)=>{let t=[];for(let a=0;a<n.length;a++){let o=n[a];if(o)for(let l=0;l<o.length;l++){let u=o[l];if(!u)continue;let p=ve(r,u);p&&t.push(me(l,a,u,p))}}return t},me=(n,r,t,a)=>({symbol:t,sprite:a.sprite??null,position:[n,r],dialog:a.dialog??null,onScreen:!1,end:a.end??null,sound:a.sound??null,solid:a.solid!==!1,visible:a.visible!==!1,onCollide:a.onCollide,onEnter:a.onEnter,onLeave:a.onLeave,onScreenEnter:a.onScreenEnter,onScreenLeave:a.onScreenLeave}),ve=(n,r)=>{let t=n[r];if(t)return typeof t=="function"?t():t},Ke=n=>{let r={};for(let t in n){let a=n[t];a!==void 0&&(r[t]=Array.isArray(a)?[...a]:a)}return W(r)},Je=n=>{let r=W(n),t=[0,0];return r.subscribe(a=>{t=Se(B(a))}),{store:r,getDimensions(){return t}}},ze=n=>{let r=n.sprite??null,t=n.position??[0,0],a=n.sprite??null,o=n.position??[0,0],l=W({sprite:a,position:o});return l.subscribe(u=>{a=u.sprite??null,o=u.position}),{playerProxy:{get sprite(){return a},set sprite(u){l.set({sprite:u,position:o})},get position(){return o},set position(u){l.set({sprite:a,position:u})}},playerStore:l,restoreSavedState:()=>{l.set({sprite:r,position:t})},saveCurrentState:()=>{r=a,t=[...o]}}},et=n=>{let r=Je(n.map),t=Ke(n.filter?.settings??{}),a=ze(n.player),o=Qe(n,r);return{player:a,actors:o,mapStore:r,uniformsStore:t}},tt=class{controls;lastKeysEvents=new Map;onInput;lastPointerEvent=0;oldTouchX;oldTouchY;pointerId;isSliding=!1;constructor(n,r){this.controls=Object.entries(n.controls),this.onInput=r;let t=document.createElement("div");t.style.setProperty("position","absolute"),t.style.setProperty("left","0"),t.style.setProperty("height","0"),t.style.setProperty("width","100vw"),t.style.setProperty("height","100vh"),t.style.setProperty("overflow","hidden"),t.style.setProperty("touch-action","none"),document.body.appendChild(t),document.body.style.setProperty("margin","0"),document.addEventListener("keydown",this.handleKeydown),t.addEventListener("pointerdown",this.handleTouch),t.addEventListener("pointerup",this.handleTouchUp),t.addEventListener("pointerleave",this.handleTouchLeave),t.addEventListener("pointercancel",this.handleTouchLeave),t.addEventListener("pointermove",this.handleTouchMove)}handleTouch=n=>{n.pointerType!=="mouse"&&(this.pointerId=n.pointerId,this.oldTouchX=n.clientX,this.oldTouchY=n.clientY)};handleTouchUp=n=>{this.pointerId===n.pointerId&&(this.pointerId=void 0,this.isSliding||this.onInput("ACTION"),this.isSliding=!1)};handleTouchLeave=n=>{this.pointerId===n.pointerId&&(this.pointerId=void 0,this.isSliding=!1)};handleTouchMove=n=>{if(this.pointerId!==n.pointerId)return;let r=n.clientX,t=n.clientY;if(r===void 0||t===void 0||this.oldTouchX===void 0||this.oldTouchY===void 0)return;let a=r-this.oldTouchX,o=t-this.oldTouchY,l=n.timeStamp;if(!(Math.abs(a)<30&&Math.abs(o)<30)&&!(l-this.lastPointerEvent<200))if(this.lastPointerEvent=l,this.oldTouchX=r,this.oldTouchY=t,this.isSliding=!0,Math.abs(o)>Math.abs(a)){let u=Math.sign(o);this.onInput(u<0?"UP":"DOWN")}else{let u=Math.sign(a);this.onInput(u<0?"LEFT":"RIGHT")}};handleKeydown=n=>{let r=this.controls.find(([l,u])=>u===n.code||u.includes(n.code));if(!r)return;let[t]=r,a=n.timeStamp,o=this.lastKeysEvents.get(n.code);n.repeat&&o&&a-o<200||(this.lastKeysEvents.set(n.code,a),this.onInput(t))}},nt=(n,r)=>new tt(n,r),it=30,rt=class{#t;#n;isOpen=!1;#r;#e=[];#i=[];#a;#l;#o=0;#s;#u=0;#c;#f;#m;#p;#d=192;#h=1;#_=2;constructor(n){this.#f=n.colors,this.#m=this.#g(n.messageBackground),this.#p=this.#g(n.messageColor),this.#a=Math.floor((this.#d-2*this.#h)/8),this.#l=Math.floor(this.#d/(8+this.#_)),this.#t=document.createElement("canvas"),this.#t.style.setProperty("position","absolute"),this.#t.style.setProperty("box-sizing","border-box"),this.#t.style.setProperty("display","none"),this.#t.style.setProperty("image-rendering","pixelated"),this.#n=this.#t.getContext("2d"),this.#t.width=this.#d,this.#t.height=this.#d,this.#t.classList.add("odyc-message-canvas"),this.#c=new J(`
`,this.#p,this.#f),this.#v(),window.addEventListener("resize",this.#v),document.body.append(this.#t)}#v=()=>{let n=Math.min(window.innerWidth,window.innerHeight),r=(window.innerWidth-n)*.5,t=(window.innerHeight-n)*.5;this.#t.style.setProperty("width",`${n}px`),this.#t.style.setProperty("height",`${n}px`),this.#t.style.setProperty("left",`${r}px`),this.#t.style.setProperty("top",`${t}px`)};open(n){let r=typeof n=="string"?[n]:[...n];if(r.length===0||r[0]?.length===0)return;this.isOpen=!0,this.#e=r;let t=this.#e[this.#o];if(t)return this.#i=this.#c.parseText(t,this.#a),this.#t.style.removeProperty("display"),this.#s=requestAnimationFrame(this.#y),new Promise(a=>this.#r=()=>a())}next(){this.#o++;let n=this.#e[this.#o];n?(this.#i=this.#c.parseText(n,this.#a),this.#s=requestAnimationFrame(this.#y)):this.close()}#y=n=>{this.#s=requestAnimationFrame(this.#y),!(n-this.#u<it)&&this.#w(n)};#w(n){this.#n.clearRect(0,0,this.#t.width,this.#t.height),this.#n.fillStyle=this.#m,this.#n.fillRect(0,0,this.#t.width,this.#t.height),this.#n.fillStyle=this.#p;let r=Math.min(this.#i.length,this.#l),t=r*8+(r-1)*this.#_,a=(this.#t.height-t)*.5;for(let o=0;o<r;o++){let l=this.#i[o];if(!l)continue;let u=l.length*8,p=(this.#t.width-u)*.5,m=a+o*8+o*this.#_;this.#c.draw(this.#n,l,p,m,n)}}close=()=>{this.#o=0,this.#i=[],this.isOpen=!1,this.#s&&cancelAnimationFrame(this.#s),this.#t.style.setProperty("display","none"),this.#r?.()};#g(n){return typeof n=="string"?n:this.#f[n]??"black"}},at=n=>new rt(n),X=384,T=2,de=28,U=10,M=8,$=12,H=8,F=2,ot=class{#t;#n;#r;isOpen=!1;#e=[];#i=0;#a;#l;#o;#s;constructor(n){this.#a=n.colors,this.#l=this.#h(n.dialogBackground),this.#o=this.#h(n.dialogColor),this.#s=this.#h(n.dialogBorder),this.#t=document.createElement("canvas"),this.#t.style.setProperty("position","absolute"),this.#t.style.setProperty("box-sizing","border-box"),this.#t.style.setProperty("display","none"),this.#t.style.setProperty("image-rendering","pixelated"),this.#n=this.#t.getContext("2d"),this.#t.width=X,this.#t.height=X,this.#t.classList.add("odyc-prompt-canvas"),this.#p(),document.body.append(this.#t),window.addEventListener("resize",this.#p)}get#u(){let n=de*8+M*2,r=(this.#t.width-n)*.5,t=Math.floor(X/15),a=Math.max(Math.ceil(this.#e.length/T),2),o=a*H+$*2+U*(a-1);return{left:r,top:t,width:n,height:o}}async openMenu(n){let r=Object.keys(n),t=r[await this.open(...r)];if(!t||!(t in n))return;let a=n[t];if(a)return typeof a=="function"?a():await this.openMenu(a)}async open(...n){return n.length?(this.#i=0,this.isOpen=!0,this.#t.style.setProperty("display","block"),this.#e=n,this.#f(),new Promise(r=>{this.#r=t=>r(t)})):-1}input(n){let r=Math.ceil(this.#e.length/T),t=Math.floor(this.#i/T),a=this.#i-t*T;switch(n){case"LEFT":a=Math.max(0,a-1);break;case"UP":t=Math.max(0,t-1);break;case"RIGHT":a=Math.min(a+1,T-1);break;case"DOWN":t=Math.min(t+1,r-1);break;case"ACTION":this.#c();return}this.#i=Math.min(t*T+a,this.#e.length-1),this.#f()}#c(){this.isOpen=!1,this.#t.style.setProperty("display","none"),this.#r?.(this.#i)}#f(){this.#d();let{left:n,top:r,width:t}=this.#u;this.#n.fillStyle=this.#o;let a=Math.ceil(de/T-T);for(let o=0;o<this.#e.length;o++){let l=this.#e[o]?.slice(0,a);if(!l)continue;let u=Math.floor(o/T),p=o-u*T,m=n+M+p*(t-M*2)/T+(p+1)*H,_=r+$+8*u+u*U;J.text(this.#n,l,m,_)}this.#m()}#m(){let n=Math.floor(this.#i/T),r=this.#i-n*T,{left:t,top:a,width:o}=this.#u,l=t+M+r*(o-M*2)/T+r*H,u=a+$+8*n+n*U;for(let p=0;p<H/2;p++)this.#n.fillRect(l+p,u+p,1,8-2*p)}#p=()=>{let n=Math.min(window.innerWidth,window.innerHeight),r=(window.innerWidth-n)*.5,t=(window.innerHeight-n)*.5;this.#t.style.setProperty("width",`${n}px`),this.#t.style.setProperty("height",`${n}px`),this.#t.style.setProperty("left",`${r}px`),this.#t.style.setProperty("top",`${t}px`)};#d(){this.#n.clearRect(0,0,this.#t.width,this.#t.height),this.#n.fillStyle=this.#s;let{left:n,top:r,height:t,width:a}=this.#u;this.#n.fillRect(n-F,r-F,a+F*2,t+F*2),this.#n.fillStyle=this.#l,this.#n.fillRect(n,r,a,t)}#h(n){return typeof n=="string"?n:this.#a[n]??"black"}},st=n=>new ot(n),lt=class{canvas;#t=24;screenWidth;screenHeight;cellWidth;cellHeight;colors;ctx;background;constructor(n){this.screenWidth=n.screenWidth,this.screenHeight=n.screenHeight,this.cellWidth=n.cellWidth,this.cellHeight=n.cellHeight,this.colors=n.colors,this.background=n.background,this.canvas=document.createElement("canvas"),this.canvas.width=this.cellWidth*n.screenWidth*this.#t,this.canvas.height=this.cellHeight*n.screenHeight*this.#t,this.canvas.style.setProperty("position","absolute"),this.canvas.style.setProperty("image-rendering","pixelated"),this.canvas.classList.add("odyc-renderer-canvas");let r=this.canvas.getContext("2d");if(!r)throw new Error("failled to access context of the canvas");this.ctx=r,this.#n(),document.body.append(this.canvas),window.addEventListener("resize",this.#n)}#n=()=>{let n=this.canvas.width<this.canvas.height?"vertical":"horizontal",r=Math.min(window.innerWidth,window.innerHeight),t=n==="horizontal"?r:r/this.canvas.height*this.canvas.width,a=n==="vertical"?r:r/this.canvas.width*this.canvas.height,o=(window.innerWidth-t)*.5,l=(window.innerHeight-a)*.5;this.canvas.style.setProperty("width",`${t}px`),this.canvas.style.setProperty("height",`${a}px`),this.canvas.style.setProperty("left",`${o}px`),this.canvas.style.setProperty("top",`${l}px`)};render(n,r){this.clear();let[t,a]=r.position;for(let o of n){if(o.sprite===void 0||o.sprite===null||o.visible===!1)continue;let[l,u]=o.position,p=(l-t)*this.cellWidth,m=(u-a)*this.cellHeight;r.isOnScreen(o.position)&&this.drawTile(o.sprite,p,m)}}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.background!==void 0&&(typeof this.background=="number"?this.ctx.fillStyle=this.colors[this.background]??this.colors[0]??"black":this.ctx.fillStyle=this.background,this.ctx.fillRect(0,0,this.screenWidth*this.cellWidth*this.#t,this.screenHeight*this.cellHeight*this.#t))}drawTile(n,r,t){if(r+this.cellWidth<0||t+this.cellHeight<0||r>this.screenWidth*this.cellWidth||t>this.screenHeight*this.cellHeight)return;if(typeof n=="number"){let o=this.colors[n];if(!o)return;this.ctx.fillStyle=o,this.ctx.fillRect(Math.floor(r)*this.#t,Math.floor(t)*this.#t,this.cellWidth*this.#t,this.cellHeight*this.#t);return}let a=B(n);for(let o=0;o<this.cellHeight;o++)for(let l=0;l<this.cellWidth;l++){let u=a[o]?.charAt(l);if(!u)continue;let p=+u;if(isNaN(p))continue;let m=this.colors[p];m&&(this.ctx.fillStyle=m,this.ctx.fillRect(Math.floor(r+l)*this.#t,Math.floor(t+o)*this.#t,this.#t,this.#t))}}},ut=n=>new lt(n),ye={waveForm:[{name:"waveForm",defaultValue:0,type:"radio",options:[{value:0,label:"Sine"},{value:1,label:"SawTooth"},{value:2,label:"Square"},{value:3,label:"Triangle"}]}],volume:[{name:"volume",min:0,max:1,step:.01,type:"range",defaultValue:.5}],soundEnveloppe:[{name:"attackTime",min:0,max:2,step:.01,type:"range",defaultValue:0},{name:"sustainTime",min:0,max:2,step:.01,type:"range",defaultValue:.07},{name:"sustainPunch",min:0,max:1,step:.01,type:"range",defaultValue:0},{name:"decayTime",min:0,max:2,step:.01,type:"range",defaultValue:.3}],pitch:[{name:"frequency",min:0,max:4e3,step:1,type:"range",defaultValue:700},{name:"pitchDelta",min:-4e3,max:4e3,step:1,type:"range",defaultValue:0},{name:"pitchDuration",min:0,max:1,step:.01,type:"range",defaultValue:1},{name:"pitchDelay",min:0,max:1,step:.01,type:"range",defaultValue:0}],vibrato:[{name:"vibratoRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"vibratoDepth",min:0,max:100,step:1,type:"range",defaultValue:0}],tremolo:[{name:"tremoloRate",min:0,max:70,step:1,type:"range",defaultValue:0},{name:"tremoloDepth",min:0,max:1,step:.01,type:"range",defaultValue:0}],filters:[{name:"highPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:0},{name:"highPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0},{name:"lowPassCutoff",min:0,max:4e3,step:.1,type:"range",defaultValue:4e3},{name:"lowPassResonance",min:0,max:30,step:.1,type:"range",defaultValue:0}],phaser:[{name:"phaserBaseFrequency",min:0,max:1e3,step:1,type:"range",defaultValue:100},{name:"phaserLfoFrequency",min:0,max:200,step:1,type:"range",defaultValue:50},{name:"phaserDepth",min:0,max:1e3,step:1,type:"range",defaultValue:0}],noise:[{name:"noiseAmount",min:0,max:500,step:1,type:"range",defaultValue:0}]},E=Object.values(ye).flatMap(n=>[...n]),V=E.reduce((n,r)=>({...n,[r.name]:r.defaultValue}),{}),ct=(n,{noiseAmount:r})=>{let t=n.createWaveShaper(),a=44100,o=new Float32Array(a),l=Math.PI/180;for(let u=0;u<a;u++){let p=u*2/a-1;o[u]=(3+Math.random()*r)*p*20*l/(Math.PI+Math.random()*r*Math.abs(p))}return t.curve=o,t.oversample="4x",{input:t,output:t}},dt=(n,{attackTime:r,sustainTime:t,sustainPunch:a,decayTime:o})=>{let l=n.createGain(),u=n.currentTime;return l.gain.setValueAtTime(0,u),l.gain.linearRampToValueAtTime(1-a,u+r),l.gain.setValueAtTime(1,u+r),l.gain.linearRampToValueAtTime(1-a,u+r+t),l.gain.linearRampToValueAtTime(0,u+r+t+o),{input:l,output:l}},ht=(n,{highPassCutoff:r,highPassResonance:t})=>{let a=n.createBiquadFilter();return a.type="highpass",a.frequency.value=r,a.Q.value=t,{input:a,output:a}},ft=(n,{lowPassCutoff:r,lowPassResonance:t})=>{let a=n.createBiquadFilter();return a.type="lowpass",a.frequency.value=r,a.Q.value=t,{input:a,output:a}},pt=(n,r,t)=>Math.min(Math.max(n,r),t),_t=(n,r)=>Math.round(n*10**r)/10**r,mt=["sine","sawtooth","square","triangle"],vt=ye.pitch[0].max,yt=(n,r,{waveForm:t,frequency:a,pitchDelta:o,pitchDuration:l,pitchDelay:u})=>{let p=r*u,m=(r-p)*l,_=n.createOscillator();return _.type=mt[t]??"sine",_.frequency.setValueAtTime(a,n.currentTime),_.frequency.linearRampToValueAtTime(a,n.currentTime+p),_.frequency.linearRampToValueAtTime(pt(0,a+o,vt),n.currentTime+p+m),{input:_,output:_,start:()=>_.start(),stop:y=>_.stop(y)}},gt=(n,{phaserBaseFrequency:r,phaserLfoFrequency:t,phaserDepth:a})=>{let o=n.createBiquadFilter();o.type="allpass",o.frequency.value=r;let l=n.createOscillator();l.type="sine",l.frequency.value=t;let u=n.createGain();return u.gain.value=a,l.connect(u),u.connect(o.frequency),{input:o,output:o,start:()=>l.start(),stop:p=>l?.stop(p)}},ge=(n,r,t)=>{let a=n.createOscillator(),o=n.createGain();return a.frequency.value=t,o.gain.value=r,a.connect(o),{input:a,output:o,start:()=>a.start(),stop:l=>a.stop(l)}},wt=(n,{tremoloDepth:r,tremoloRate:t})=>ge(n,r,t),bt=(n,{vibratoDepth:r,vibratoRate:t})=>ge(n,r,t),At=(n,{volume:r})=>{let t=n.createGain();return t.gain.value=r,{input:t,output:t}},Tt=(n,r,t)=>{let a=Object.assign({},V,n),o=a.attackTime+a.sustainTime+a.decayTime,l=yt(r,o,a),u=ct(r,a),p=dt(r,a),m=bt(r,a),_=wt(r,a),y=ft(r,a),e=ht(r,a),i=gt(r,a),s=At(r,a);m.output.connect(l.input.frequency),_.output.connect(p.input),l.output.connect(u.input),u.output.connect(i.input),i.output.connect(y.input),y.output.connect(e.input),e.output.connect(p.input),p.output.connect(s.input),s.output.connect(t);let c=[m,_,l,i,y,p];return new Promise(h=>{c.forEach(f=>{f.start?.(),f.stop?.(r.currentTime+o)}),l.output.onended=()=>h()})},xt=n=>{let r={...V},t=n.searchParams.get("fx");if(!t)return r;let a=decodeURI(t).split(",");for(let o=0;o<E.length;o++){let l=E[o]?.name,u=a[o];l&&u&&!isNaN(Number(u))&&(r[l]=Number(u))}return r},St=class{seed;#t;#n;#r;#e;constructor(n){this.seed=n??Date.now(),this.#t=this.seed&4294967295,this.#n=362436069,this.#r=521288629,this.#e=88675123;for(let r=0;r<32;r++)this.#i()}#i(){let n=this.#t^this.#t<<11&4294967295;return this.#t=this.#n,this.#n=this.#r,this.#r=this.#e,this.#e=this.#e^this.#e>>>19^(n^n>>>8),this.#e+2147483648}number(n,r){return n===void 0?(n=0,r=1):r===void 0&&(r=n,n=0),n+(r-n)*this.#i()/4294967295}boolean(n=.5){return this.number(0,1)<n}fromArray(n){return n[Math.floor(this.number(0,n.length))]}},Pt=n=>(E.forEach(r=>{let t=n[r.name];if(r.type==="range"&&t){let a=r.step.toString().split(".")[1]?.length??0;n[r.name]=_t(t,a)}}),Object.assign({},V,n)),It=(n,r)=>Pt(n(new St(r))),he={DEFAULT:()=>({}),PICKUP:n=>({...n.boolean()?{pitchDelta:n.number(100,500),pitchDuration:0,pitchDelay:n.number(0,.7)}:{},waveForm:n.fromArray([0,1,2,3]),sustainPunch:n.number(0,.8),sustainTime:n.number(.05,.2),decayTime:n.number(.1,.3),frequency:n.number(900,1700)}),LASER:n=>{let r=n.number(100,1300);return{waveForm:n.fromArray([0,1,2,3]),sustainPunch:n.number(0,.8),sustainTime:n.number(.05,.1),decayTime:n.number(0,.2),frequency:r,pitchDelta:n.number(-r,-100),pitchDuration:1,pitchDelay:n.fromArray([0,n.number(0,.3)])}},JUMP:n=>({waveForm:n.fromArray([1,2]),sustainPunch:n.number(0,.8),sustainTime:n.number(.2,.5),decayTime:n.number(.1,.2),frequency:n.number(100,500),pitchDelta:n.number(200,500),pitchDuration:1,pitchDelay:n.fromArray([0,n.number(0,.3)])}),FALL:n=>{let r=n.number(80,500);return{waveForm:n.fromArray([1,2,3]),sustainPunch:0,sustainTime:n.number(.2,.5),decayTime:n.number(.2,.5),frequency:r,pitchDelta:-r,pitchDuration:1,pitchDelay:n.number(0,.2),vibratoRate:n.number(8,18),vibratoDepth:n.number(10,30),tremoloRate:n.number(5,18),tremoloDepth:n.number(0,1)}},POWERUP:n=>({waveForm:n.fromArray([0,1,2,3]),sustainPunch:n.number(0,1),sustainTime:n.number(.2,.5),decayTime:n.number(.1,.5),frequency:n.number(200,1e3),pitchDelta:n.number(100,300),pitchDuration:1,pitchDelay:n.fromArray([0,n.number(0,.3)]),vibratoRate:n.number(10,18),vibratoDepth:n.number(50,100)}),EXPLOSION:n=>{let r=n.number(200);return{waveForm:n.fromArray([0,1,2,3]),volume:.3,sustainPunch:n.number(0,.3),sustainTime:n.number(.4,1.3),decayTime:n.number(.1,.5),frequency:r,pitchDelta:-r,pitchDuration:1,pitchDelay:n.number(.3),vibratoRate:n.number(0,70),vibratoDepth:n.number(0,100),tremoloRate:n.number(0,70),tremoloDepth:n.number(0,1),phaserDepth:n.number(300,1e3),noiseAmount:n.number(300,500)}},BLIP:n=>({waveForm:n.fromArray([0,1,2,3]),sustainTime:n.number(.02,.1),decayTime:n.number(0,.04),frequency:n.number(600,3e3)}),HIT:n=>{let r=n.number(20,500);return{waveForm:n.fromArray([0,1,2,3]),sustainTime:n.number(.01,.03),sustainPunch:n.number(.5),decayTime:n.number(0,.2),frequency:r,pitchDelta:n.number(-r,-r*.2),noiseAmount:n.number(100)}},FART:n=>{let r=n.number(30,150);return{waveForm:1,volume:.7,sustainPunch:n.number(0,.2),sustainTime:n.number(.1,.5),decayTime:n.number(.3,.5),frequency:r,pitchDelta:-r/2,pitchDuration:1,pitchDelay:.1,vibratoRate:n.number(8,18),vibratoDepth:n.number(10,30),tremoloRate:n.number(35,70),tremoloDepth:n.number(.6,1),lowPassCutoff:r*10,lowPassResonance:10,noiseAmount:n.number(0,30)}},RANDOM:n=>{let r={...V};for(let t=0;t<E.length;t++){let a=E[t];a&&(a.type==="range"?r[a.name]=n.number(a.min,a.max):a.type==="radio"&&(r[a.name]=n.fromArray(a.options.map(o=>o.value))))}return r}},Et=class{#t;#n;#r=!1;constructor(n){this.#t=new AudioContext,this.#n=this.#t.createGain(),this.#n.gain.value=n.volume,this.#n.connect(this.#t.destination)}async play(...n){if(this.#r)return;this.#r=!0;let r=this.#e(...n);return Tt(r,this.#t,this.#n).then(()=>{this.#r=!1})}#e(...n){let[r,t]=n;return typeof r!="string"?r:Pe(r)?xt(new URL(r)):r in he?It(he[r],t):{}}},kt=n=>new Et(n),Mt=n=>{let r=Object.assign({},xe,n),t=et(r),a=kt(r),o=Te(r),l=ut(r),u=Be(r),p=st(r),m=at(r),_=Ue(l.canvas,r.filter),y=We({gameState:t,messageBox:m,camera:o}),e=Ze({gameState:t,soundPlayer:a,dialog:u,ender:y});nt(r,s=>{p.isOpen?p.input(s):m.isOpen?s==="ACTION"&&m.next():u.isOpen?s==="ACTION"&&u.next():s!=="ACTION"&&e.update(s)});let i=Ee(()=>{_?.setUniforms(t.uniformsStore?.get()),o.update(t.player.playerProxy.position,t.mapStore.getDimensions());let s=[];t.actors._store.silentUpdate(c=>c.map(h=>{let f=o.isOnScreen(h.position);if(f!==h.onScreen){let d=t.actors.getCell(...h.position);f&&h.onScreenEnter?s.push(()=>h.onScreenEnter?.(d)):!f&&h.onScreenLeave&&s.push(()=>h.onScreenLeave?.(d))}return h.onScreen=f,h})),s.forEach(c=>c()),l.render([...t.actors._store.get(),t.player.playerProxy],o),_?.render()},60);return t.actors._store.subscribe(i),t.player.playerStore.subscribe(i),t.uniformsStore.subscribe(i),r.title&&m.open(r.title),$e(t,u,p,a,y,m)},O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Y={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var fe;function Ot(){return fe||(fe=1,function(n){(function(){var r=function(){this.init()};r.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var i=this||t;if(e=parseFloat(e),i.ctx||y(),typeof e<"u"&&e>=0&&e<=1){if(i._volume=e,i._muted)return i;i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var s=0;s<i._howls.length;s++)if(!i._howls[s]._webAudio)for(var c=i._howls[s]._getSoundIds(),h=0;h<c.length;h++){var f=i._howls[s]._soundById(c[h]);f&&f._node&&(f._node.volume=f._volume*e)}return i}return i._volume},mute:function(e){var i=this||t;i.ctx||y(),i._muted=e,i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e?0:i._volume,t.ctx.currentTime);for(var s=0;s<i._howls.length;s++)if(!i._howls[s]._webAudio)for(var c=i._howls[s]._getSoundIds(),h=0;h<c.length;h++){var f=i._howls[s]._soundById(c[h]);f&&f._node&&(f._node.muted=e?!0:f._muted)}return i},stop:function(){for(var e=this||t,i=0;i<e._howls.length;i++)e._howls[i].stop();return e},unload:function(){for(var e=this||t,i=e._howls.length-1;i>=0;i--)e._howls[i].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,y()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{var i=new Audio;typeof i.oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{var i=new Audio;i.muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,i=null;try{i=typeof Audio<"u"?new Audio:null}catch{return e}if(!i||typeof i.canPlayType!="function")return e;var s=i.canPlayType("audio/mpeg;").replace(/^no$/,""),c=e._navigator?e._navigator.userAgent:"",h=c.match(/OPR\/(\d+)/g),f=h&&parseInt(h[0].split("/")[1],10)<33,d=c.indexOf("Safari")!==-1&&c.indexOf("Chrome")===-1,v=c.match(/Version\/(.*?) /),g=d&&v&&parseInt(v[1],10)<15;return e._codecs={mp3:!!(!f&&(s||i.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!s,opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(i.canPlayType('audio/wav; codecs="1"')||i.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!i.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(i.canPlayType("audio/x-m4b;")||i.canPlayType("audio/m4b;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!g&&i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!g&&i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!i.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(i.canPlayType("audio/x-flac;")||i.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!(e._audioUnlocked||!e.ctx)){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&e.ctx.sampleRate!==44100&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var i=function(s){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var c=new Audio;c._unlocked=!0,e._releaseHtml5Audio(c)}catch{e.noAudio=!0;break}for(var h=0;h<e._howls.length;h++)if(!e._howls[h]._webAudio)for(var f=e._howls[h]._getSoundIds(),d=0;d<f.length;d++){var v=e._howls[h]._soundById(f[d]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}e._autoResume();var g=e.ctx.createBufferSource();g.buffer=e._scratchBuffer,g.connect(e.ctx.destination),typeof g.start>"u"?g.noteOn(0):g.start(0),typeof e.ctx.resume=="function"&&e.ctx.resume(),g.onended=function(){g.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",i,!0),document.removeEventListener("touchend",i,!0),document.removeEventListener("click",i,!0),document.removeEventListener("keydown",i,!0);for(var b=0;b<e._howls.length;b++)e._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var i=new Audio().play();return i&&typeof Promise<"u"&&(i instanceof Promise||typeof i.then=="function")&&i.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var i=this||t;return e._unlocked&&i._html5AudioPool.push(e),i},_autoSuspend:function(){var e=this;if(!(!e.autoSuspend||!e.ctx||typeof e.ctx.suspend>"u"||!t.usingWebAudio)){for(var i=0;i<e._howls.length;i++)if(e._howls[i]._webAudio){for(var s=0;s<e._howls[i]._sounds.length;s++)if(!e._howls[i]._sounds[s]._paused)return e}return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var c=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(c,c)}},3e4),e}},_autoResume:function(){var e=this;if(!(!e.ctx||typeof e.ctx.resume>"u"||!t.usingWebAudio))return e.state==="running"&&e.ctx.state!=="interrupted"&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):e.state==="suspended"||e.state==="running"&&e.ctx.state==="interrupted"?(e.ctx.resume().then(function(){e.state="running";for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):e.state==="suspending"&&(e._resumeAfterSuspend=!0),e}};var t=new r,a=function(e){var i=this;if(!e.src||e.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}i.init(e)};a.prototype={init:function(e){var i=this;return t.ctx||y(),i._autoplay=e.autoplay||!1,i._format=typeof e.format!="string"?e.format:[e.format],i._html5=e.html5||!1,i._muted=e.mute||!1,i._loop=e.loop||!1,i._pool=e.pool||5,i._preload=typeof e.preload=="boolean"||e.preload==="metadata"?e.preload:!0,i._rate=e.rate||1,i._sprite=e.sprite||{},i._src=typeof e.src!="string"?e.src:[e.src],i._volume=e.volume!==void 0?e.volume:1,i._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:e.xhr&&e.xhr.withCredentials?e.xhr.withCredentials:!1},i._duration=0,i._state="unloaded",i._sounds=[],i._endTimers={},i._queue=[],i._playLock=!1,i._onend=e.onend?[{fn:e.onend}]:[],i._onfade=e.onfade?[{fn:e.onfade}]:[],i._onload=e.onload?[{fn:e.onload}]:[],i._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],i._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],i._onpause=e.onpause?[{fn:e.onpause}]:[],i._onplay=e.onplay?[{fn:e.onplay}]:[],i._onstop=e.onstop?[{fn:e.onstop}]:[],i._onmute=e.onmute?[{fn:e.onmute}]:[],i._onvolume=e.onvolume?[{fn:e.onvolume}]:[],i._onrate=e.onrate?[{fn:e.onrate}]:[],i._onseek=e.onseek?[{fn:e.onseek}]:[],i._onunlock=e.onunlock?[{fn:e.onunlock}]:[],i._onresume=[],i._webAudio=t.usingWebAudio&&!i._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(i),i._autoplay&&i._queue.push({event:"play",action:function(){i.play()}}),i._preload&&i._preload!=="none"&&i.load(),i},load:function(){var e=this,i=null;if(t.noAudio){e._emit("loaderror",null,"No audio support.");return}typeof e._src=="string"&&(e._src=[e._src]);for(var s=0;s<e._src.length;s++){var c,h;if(e._format&&e._format[s])c=e._format[s];else{if(h=e._src[s],typeof h!="string"){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}c=/^data:audio\/([^;,]+);/i.exec(h),c||(c=/\.([^.]+)$/.exec(h.split("?",1)[0])),c&&(c=c[1].toLowerCase())}if(c||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),c&&t.codecs(c)){i=e._src[s];break}}if(!i){e._emit("loaderror",null,"No codec support for selected audio sources.");return}return e._src=i,e._state="loading",window.location.protocol==="https:"&&i.slice(0,5)==="http:"&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&u(e),e},play:function(e,i){var s=this,c=null;if(typeof e=="number")c=e,e=null;else{if(typeof e=="string"&&s._state==="loaded"&&!s._sprite[e])return null;if(typeof e>"u"&&(e="__default",!s._playLock)){for(var h=0,f=0;f<s._sounds.length;f++)s._sounds[f]._paused&&!s._sounds[f]._ended&&(h++,c=s._sounds[f]._id);h===1?e=null:c=null}}var d=c?s._soundById(c):s._inactiveSound();if(!d)return null;if(c&&!e&&(e=d._sprite||"__default"),s._state!=="loaded"){d._sprite=e,d._ended=!1;var v=d._id;return s._queue.push({event:"play",action:function(){s.play(v)}}),v}if(c&&!d._paused)return i||s._loadQueue("play"),d._id;s._webAudio&&t._autoResume();var g=Math.max(0,d._seek>0?d._seek:s._sprite[e][0]/1e3),b=Math.max(0,(s._sprite[e][0]+s._sprite[e][1])/1e3-g),x=b*1e3/Math.abs(d._rate),S=s._sprite[e][0]/1e3,L=(s._sprite[e][0]+s._sprite[e][1])/1e3;d._sprite=e,d._ended=!1;var G=function(){d._paused=!1,d._seek=g,d._start=S,d._stop=L,d._loop=!!(d._loop||s._sprite[e][2])};if(g>=L){s._ended(d);return}var w=d._node;if(s._webAudio){var z=function(){s._playLock=!1,G(),s._refreshBuffer(d);var P=d._muted||s._muted?0:d._volume;w.gain.setValueAtTime(P,t.ctx.currentTime),d._playStart=t.ctx.currentTime,typeof w.bufferSource.start>"u"?d._loop?w.bufferSource.noteGrainOn(0,g,86400):w.bufferSource.noteGrainOn(0,g,b):d._loop?w.bufferSource.start(0,g,86400):w.bufferSource.start(0,g,b),x!==1/0&&(s._endTimers[d._id]=setTimeout(s._ended.bind(s,d),x)),i||setTimeout(function(){s._emit("play",d._id),s._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?z():(s._playLock=!0,s.once("resume",z),s._clearTimer(d._id))}else{var ee=function(){w.currentTime=g,w.muted=d._muted||s._muted||t._muted||w.muted,w.volume=d._volume*t.volume(),w.playbackRate=d._rate;try{var P=w.play();if(P&&typeof Promise<"u"&&(P instanceof Promise||typeof P.then=="function")?(s._playLock=!0,G(),P.then(function(){s._playLock=!1,w._unlocked=!0,i?s._loadQueue():s._emit("play",d._id)}).catch(function(){s._playLock=!1,s._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),d._ended=!0,d._paused=!0})):i||(s._playLock=!1,G(),s._emit("play",d._id)),w.playbackRate=d._rate,w.paused){s._emit("playerror",d._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}e!=="__default"||d._loop?s._endTimers[d._id]=setTimeout(s._ended.bind(s,d),x):(s._endTimers[d._id]=function(){s._ended(d),w.removeEventListener("ended",s._endTimers[d._id],!1)},w.addEventListener("ended",s._endTimers[d._id],!1))}catch(be){s._emit("playerror",d._id,be)}};w.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(w.src=s._src,w.load());var we=window&&window.ejecta||!w.readyState&&t._navigator.isCocoonJS;if(w.readyState>=3||we)ee();else{s._playLock=!0,s._state="loading";var te=function(){s._state="loaded",ee(),w.removeEventListener(t._canPlayEvent,te,!1)};w.addEventListener(t._canPlayEvent,te,!1),s._clearTimer(d._id)}}return d._id},pause:function(e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"pause",action:function(){i.pause(e)}}),i;for(var s=i._getSoundIds(e),c=0;c<s.length;c++){i._clearTimer(s[c]);var h=i._soundById(s[c]);if(h&&!h._paused&&(h._seek=i.seek(s[c]),h._rateSeek=0,h._paused=!0,i._stopFade(s[c]),h._node))if(i._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),i._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||i._emit("pause",h?h._id:null)}return i},stop:function(e,i){var s=this;if(s._state!=="loaded"||s._playLock)return s._queue.push({event:"stop",action:function(){s.stop(e)}}),s;for(var c=s._getSoundIds(e),h=0;h<c.length;h++){s._clearTimer(c[h]);var f=s._soundById(c[h]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,s._stopFade(c[h]),f._node&&(s._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),s._cleanBuffer(f._node)):(!isNaN(f._node.duration)||f._node.duration===1/0)&&(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&s._clearSound(f._node))),i||s._emit("stop",f._id))}return s},mute:function(e,i){var s=this;if(s._state!=="loaded"||s._playLock)return s._queue.push({event:"mute",action:function(){s.mute(e,i)}}),s;if(typeof i>"u")if(typeof e=="boolean")s._muted=e;else return s._muted;for(var c=s._getSoundIds(i),h=0;h<c.length;h++){var f=s._soundById(c[h]);f&&(f._muted=e,f._interval&&s._stopFade(f._id),s._webAudio&&f._node?f._node.gain.setValueAtTime(e?0:f._volume,t.ctx.currentTime):f._node&&(f._node.muted=t._muted?!0:e),s._emit("mute",f._id))}return s},volume:function(){var e=this,i=arguments,s,c;if(i.length===0)return e._volume;if(i.length===1||i.length===2&&typeof i[1]>"u"){var h=e._getSoundIds(),f=h.indexOf(i[0]);f>=0?c=parseInt(i[0],10):s=parseFloat(i[0])}else i.length>=2&&(s=parseFloat(i[0]),c=parseInt(i[1],10));var d;if(typeof s<"u"&&s>=0&&s<=1){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,i)}}),e;typeof c>"u"&&(e._volume=s),c=e._getSoundIds(c);for(var v=0;v<c.length;v++)d=e._soundById(c[v]),d&&(d._volume=s,i[2]||e._stopFade(c[v]),e._webAudio&&d._node&&!d._muted?d._node.gain.setValueAtTime(s,t.ctx.currentTime):d._node&&!d._muted&&(d._node.volume=s*t.volume()),e._emit("volume",d._id))}else return d=c?e._soundById(c):e._sounds[0],d?d._volume:0;return e},fade:function(e,i,s,c){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(e,i,s,c)}}),h;e=Math.min(Math.max(0,parseFloat(e)),1),i=Math.min(Math.max(0,parseFloat(i)),1),s=parseFloat(s),h.volume(e,c);for(var f=h._getSoundIds(c),d=0;d<f.length;d++){var v=h._soundById(f[d]);if(v){if(c||h._stopFade(f[d]),h._webAudio&&!v._muted){var g=t.ctx.currentTime,b=g+s/1e3;v._volume=e,v._node.gain.setValueAtTime(e,g),v._node.gain.linearRampToValueAtTime(i,b)}h._startFadeInterval(v,e,i,s,f[d],typeof c>"u")}}return h},_startFadeInterval:function(e,i,s,c,h,f){var d=this,v=i,g=s-i,b=Math.abs(g/.01),x=Math.max(4,b>0?c/b:c),S=Date.now();e._fadeTo=s,e._interval=setInterval(function(){var L=(Date.now()-S)/c;S=Date.now(),v+=g*L,v=Math.round(v*100)/100,g<0?v=Math.max(s,v):v=Math.min(s,v),d._webAudio?e._volume=v:d.volume(v,e._id,!0),f&&(d._volume=v),(s<i&&v<=s||s>i&&v>=s)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,d.volume(s,e._id),d._emit("fade",e._id))},x)},_stopFade:function(e){var i=this,s=i._soundById(e);return s&&s._interval&&(i._webAudio&&s._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(s._interval),s._interval=null,i.volume(s._fadeTo,e),s._fadeTo=null,i._emit("fade",e)),i},loop:function(){var e=this,i=arguments,s,c,h;if(i.length===0)return e._loop;if(i.length===1)if(typeof i[0]=="boolean")s=i[0],e._loop=s;else return h=e._soundById(parseInt(i[0],10)),h?h._loop:!1;else i.length===2&&(s=i[0],c=parseInt(i[1],10));for(var f=e._getSoundIds(c),d=0;d<f.length;d++)h=e._soundById(f[d]),h&&(h._loop=s,e._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=s,s&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,e.playing(f[d])&&(e.pause(f[d],!0),e.play(f[d],!0)))));return e},rate:function(){var e=this,i=arguments,s,c;if(i.length===0)c=e._sounds[0]._id;else if(i.length===1){var h=e._getSoundIds(),f=h.indexOf(i[0]);f>=0?c=parseInt(i[0],10):s=parseFloat(i[0])}else i.length===2&&(s=parseFloat(i[0]),c=parseInt(i[1],10));var d;if(typeof s=="number"){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,i)}}),e;typeof c>"u"&&(e._rate=s),c=e._getSoundIds(c);for(var v=0;v<c.length;v++)if(d=e._soundById(c[v]),d){e.playing(c[v])&&(d._rateSeek=e.seek(c[v]),d._playStart=e._webAudio?t.ctx.currentTime:d._playStart),d._rate=s,e._webAudio&&d._node&&d._node.bufferSource?d._node.bufferSource.playbackRate.setValueAtTime(s,t.ctx.currentTime):d._node&&(d._node.playbackRate=s);var g=e.seek(c[v]),b=(e._sprite[d._sprite][0]+e._sprite[d._sprite][1])/1e3-g,x=b*1e3/Math.abs(d._rate);(e._endTimers[c[v]]||!d._paused)&&(e._clearTimer(c[v]),e._endTimers[c[v]]=setTimeout(e._ended.bind(e,d),x)),e._emit("rate",d._id)}}else return d=e._soundById(c),d?d._rate:e._rate;return e},seek:function(){var e=this,i=arguments,s,c;if(i.length===0)e._sounds.length&&(c=e._sounds[0]._id);else if(i.length===1){var h=e._getSoundIds(),f=h.indexOf(i[0]);f>=0?c=parseInt(i[0],10):e._sounds.length&&(c=e._sounds[0]._id,s=parseFloat(i[0]))}else i.length===2&&(s=parseFloat(i[0]),c=parseInt(i[1],10));if(typeof c>"u")return 0;if(typeof s=="number"&&(e._state!=="loaded"||e._playLock))return e._queue.push({event:"seek",action:function(){e.seek.apply(e,i)}}),e;var d=e._soundById(c);if(d)if(typeof s=="number"&&s>=0){var v=e.playing(c);v&&e.pause(c,!0),d._seek=s,d._ended=!1,e._clearTimer(c),!e._webAudio&&d._node&&!isNaN(d._node.duration)&&(d._node.currentTime=s);var g=function(){v&&e.play(c,!0),e._emit("seek",c)};if(v&&!e._webAudio){var b=function(){e._playLock?setTimeout(b,0):g()};setTimeout(b,0)}else g()}else if(e._webAudio){var x=e.playing(c)?t.ctx.currentTime-d._playStart:0,S=d._rateSeek?d._rateSeek-d._seek:0;return d._seek+(S+x*Math.abs(d._rate))}else return d._node.currentTime;return e},playing:function(e){var i=this;if(typeof e=="number"){var s=i._soundById(e);return s?!s._paused:!1}for(var c=0;c<i._sounds.length;c++)if(!i._sounds[c]._paused)return!0;return!1},duration:function(e){var i=this,s=i._duration,c=i._soundById(e);return c&&(s=i._sprite[c._sprite][1]/1e3),s},state:function(){return this._state},unload:function(){for(var e=this,i=e._sounds,s=0;s<i.length;s++)i[s]._paused||e.stop(i[s]._id),e._webAudio||(e._clearSound(i[s]._node),i[s]._node.removeEventListener("error",i[s]._errorFn,!1),i[s]._node.removeEventListener(t._canPlayEvent,i[s]._loadFn,!1),i[s]._node.removeEventListener("ended",i[s]._endFn,!1),t._releaseHtml5Audio(i[s]._node)),delete i[s]._node,e._clearTimer(i[s]._id);var c=t._howls.indexOf(e);c>=0&&t._howls.splice(c,1);var h=!0;for(s=0;s<t._howls.length;s++)if(t._howls[s]._src===e._src||e._src.indexOf(t._howls[s]._src)>=0){h=!1;break}return l&&h&&delete l[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,i,s,c){var h=this,f=h["_on"+e];return typeof i=="function"&&f.push(c?{id:s,fn:i,once:c}:{id:s,fn:i}),h},off:function(e,i,s){var c=this,h=c["_on"+e],f=0;if(typeof i=="number"&&(s=i,i=null),i||s)for(f=0;f<h.length;f++){var d=s===h[f].id;if(i===h[f].fn&&d||!i&&d){h.splice(f,1);break}}else if(e)c["_on"+e]=[];else{var v=Object.keys(c);for(f=0;f<v.length;f++)v[f].indexOf("_on")===0&&Array.isArray(c[v[f]])&&(c[v[f]]=[])}return c},once:function(e,i,s){var c=this;return c.on(e,i,s,1),c},_emit:function(e,i,s){for(var c=this,h=c["_on"+e],f=h.length-1;f>=0;f--)(!h[f].id||h[f].id===i||e==="load")&&(setTimeout((function(d){d.call(this,i,s)}).bind(c,h[f].fn),0),h[f].once&&c.off(e,h[f].fn,h[f].id));return c._loadQueue(e),c},_loadQueue:function(e){var i=this;if(i._queue.length>0){var s=i._queue[0];s.event===e&&(i._queue.shift(),i._loadQueue()),e||s.action()}return i},_ended:function(e){var i=this,s=e._sprite;if(!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(i._ended.bind(i,e),100),i;var c=!!(e._loop||i._sprite[s][2]);if(i._emit("end",e._id),!i._webAudio&&c&&i.stop(e._id,!0).play(e._id),i._webAudio&&c){i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var h=(e._stop-e._start)*1e3/Math.abs(e._rate);i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),h)}return i._webAudio&&!c&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),t._autoSuspend()),!i._webAudio&&!c&&i.stop(e._id,!0),i},_clearTimer:function(e){var i=this;if(i._endTimers[e]){if(typeof i._endTimers[e]!="function")clearTimeout(i._endTimers[e]);else{var s=i._soundById(e);s&&s._node&&s._node.removeEventListener("ended",i._endTimers[e],!1)}delete i._endTimers[e]}return i},_soundById:function(e){for(var i=this,s=0;s<i._sounds.length;s++)if(e===i._sounds[s]._id)return i._sounds[s];return null},_inactiveSound:function(){var e=this;e._drain();for(var i=0;i<e._sounds.length;i++)if(e._sounds[i]._ended)return e._sounds[i].reset();return new o(e)},_drain:function(){var e=this,i=e._pool,s=0,c=0;if(!(e._sounds.length<i)){for(c=0;c<e._sounds.length;c++)e._sounds[c]._ended&&s++;for(c=e._sounds.length-1;c>=0;c--){if(s<=i)return;e._sounds[c]._ended&&(e._webAudio&&e._sounds[c]._node&&e._sounds[c]._node.disconnect(0),e._sounds.splice(c,1),s--)}}},_getSoundIds:function(e){var i=this;if(typeof e>"u"){for(var s=[],c=0;c<i._sounds.length;c++)s.push(i._sounds[c]._id);return s}else return[e]},_refreshBuffer:function(e){var i=this;return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=l[i._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),i},_cleanBuffer:function(e){var i=this,s=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return i;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),s))try{e.bufferSource.buffer=t._scratchBuffer}catch{}return e.bufferSource=null,i},_clearSound:function(e){var i=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);i||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,i._sounds.push(e),e.create(),e},create:function(){var e=this,i=e._parent,s=t._muted||e._muted||e._parent._muted?0:e._volume;return i._webAudio?(e._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(s,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=i._src,e._node.preload=i._preload===!0?"auto":i._preload,e._node.volume=s*t.volume(),e._node.load()),e},reset:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,i=e._parent;i._duration=Math.ceil(e._node.duration*10)/10,Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,i=e._parent;i._duration===1/0&&(i._duration=Math.ceil(e._node.duration*10)/10,i._sprite.__default[1]===1/0&&(i._sprite.__default[1]=i._duration*1e3),i._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var l={},u=function(e){var i=e._src;if(l[i]){e._duration=l[i].duration,_(e);return}if(/^data:[^;]+;base64,/.test(i)){for(var s=atob(i.split(",")[1]),c=new Uint8Array(s.length),h=0;h<s.length;++h)c[h]=s.charCodeAt(h);m(c.buffer,e)}else{var f=new XMLHttpRequest;f.open(e._xhr.method,i,!0),f.withCredentials=e._xhr.withCredentials,f.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(d){f.setRequestHeader(d,e._xhr.headers[d])}),f.onload=function(){var d=(f.status+"")[0];if(d!=="0"&&d!=="2"&&d!=="3"){e._emit("loaderror",null,"Failed loading audio file with status: "+f.status+".");return}m(f.response,e)},f.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete l[i],e.load())},p(f)}},p=function(e){try{e.send()}catch{e.onerror()}},m=function(e,i){var s=function(){i._emit("loaderror",null,"Decoding audio data failed.")},c=function(h){h&&i._sounds.length>0?(l[i._src]=h,_(i,h)):s()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(e).then(c).catch(s):t.ctx.decodeAudioData(e,c,s)},_=function(e,i){i&&!e._duration&&(e._duration=i.duration),Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue())},y=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),i=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),s=i?parseInt(i[1],10):null;if(e&&s&&s<9){var c=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!c&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};n.Howler=t,n.Howl=a,typeof O<"u"?(O.HowlerGlobal=r,O.Howler=t,O.Howl=a,O.Sound=o):typeof window<"u"&&(window.HowlerGlobal=r,window.Howler=t,window.Howl=a,window.Sound=o)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var a=this;if(!a.ctx||!a.ctx.listener)return a;for(var o=a._howls.length-1;o>=0;o--)a._howls[o].stereo(t);return a},HowlerGlobal.prototype.pos=function(t,a,o){var l=this;if(!l.ctx||!l.ctx.listener)return l;if(a=typeof a!="number"?l._pos[1]:a,o=typeof o!="number"?l._pos[2]:o,typeof t=="number")l._pos=[t,a,o],typeof l.ctx.listener.positionX<"u"?(l.ctx.listener.positionX.setTargetAtTime(l._pos[0],Howler.ctx.currentTime,.1),l.ctx.listener.positionY.setTargetAtTime(l._pos[1],Howler.ctx.currentTime,.1),l.ctx.listener.positionZ.setTargetAtTime(l._pos[2],Howler.ctx.currentTime,.1)):l.ctx.listener.setPosition(l._pos[0],l._pos[1],l._pos[2]);else return l._pos;return l},HowlerGlobal.prototype.orientation=function(t,a,o,l,u,p){var m=this;if(!m.ctx||!m.ctx.listener)return m;var _=m._orientation;if(a=typeof a!="number"?_[1]:a,o=typeof o!="number"?_[2]:o,l=typeof l!="number"?_[3]:l,u=typeof u!="number"?_[4]:u,p=typeof p!="number"?_[5]:p,typeof t=="number")m._orientation=[t,a,o,l,u,p],typeof m.ctx.listener.forwardX<"u"?(m.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),m.ctx.listener.forwardY.setTargetAtTime(a,Howler.ctx.currentTime,.1),m.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),m.ctx.listener.upX.setTargetAtTime(l,Howler.ctx.currentTime,.1),m.ctx.listener.upY.setTargetAtTime(u,Howler.ctx.currentTime,.1),m.ctx.listener.upZ.setTargetAtTime(p,Howler.ctx.currentTime,.1)):m.ctx.listener.setOrientation(t,a,o,l,u,p);else return _;return m},Howl.prototype.init=function(t){return function(a){var o=this;return o._orientation=a.orientation||[1,0,0],o._stereo=a.stereo||null,o._pos=a.pos||null,o._pannerAttr={coneInnerAngle:typeof a.coneInnerAngle<"u"?a.coneInnerAngle:360,coneOuterAngle:typeof a.coneOuterAngle<"u"?a.coneOuterAngle:360,coneOuterGain:typeof a.coneOuterGain<"u"?a.coneOuterGain:0,distanceModel:typeof a.distanceModel<"u"?a.distanceModel:"inverse",maxDistance:typeof a.maxDistance<"u"?a.maxDistance:1e4,panningModel:typeof a.panningModel<"u"?a.panningModel:"HRTF",refDistance:typeof a.refDistance<"u"?a.refDistance:1,rolloffFactor:typeof a.rolloffFactor<"u"?a.rolloffFactor:1},o._onstereo=a.onstereo?[{fn:a.onstereo}]:[],o._onpos=a.onpos?[{fn:a.onpos}]:[],o._onorientation=a.onorientation?[{fn:a.onorientation}]:[],t.call(this,a)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,a){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"stereo",action:function(){o.stereo(t,a)}}),o;var l=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof a>"u")if(typeof t=="number")o._stereo=t,o._pos=[t,0,0];else return o._stereo;for(var u=o._getSoundIds(a),p=0;p<u.length;p++){var m=o._soundById(u[p]);if(m)if(typeof t=="number")m._stereo=t,m._pos=[t,0,0],m._node&&(m._pannerAttr.panningModel="equalpower",(!m._panner||!m._panner.pan)&&r(m,l),l==="spatial"?typeof m._panner.positionX<"u"?(m._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),m._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),m._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):m._panner.setPosition(t,0,0):m._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),o._emit("stereo",m._id);else return m._stereo}return o},Howl.prototype.pos=function(t,a,o,l){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"pos",action:function(){u.pos(t,a,o,l)}}),u;if(a=typeof a!="number"?0:a,o=typeof o!="number"?-.5:o,typeof l>"u")if(typeof t=="number")u._pos=[t,a,o];else return u._pos;for(var p=u._getSoundIds(l),m=0;m<p.length;m++){var _=u._soundById(p[m]);if(_)if(typeof t=="number")_._pos=[t,a,o],_._node&&((!_._panner||_._panner.pan)&&r(_,"spatial"),typeof _._panner.positionX<"u"?(_._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(a,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(o,Howler.ctx.currentTime)):_._panner.setPosition(t,a,o)),u._emit("pos",_._id);else return _._pos}return u},Howl.prototype.orientation=function(t,a,o,l){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"orientation",action:function(){u.orientation(t,a,o,l)}}),u;if(a=typeof a!="number"?u._orientation[1]:a,o=typeof o!="number"?u._orientation[2]:o,typeof l>"u")if(typeof t=="number")u._orientation=[t,a,o];else return u._orientation;for(var p=u._getSoundIds(l),m=0;m<p.length;m++){var _=u._soundById(p[m]);if(_)if(typeof t=="number")_._orientation=[t,a,o],_._node&&(_._panner||(_._pos||(_._pos=u._pos||[0,0,-.5]),r(_,"spatial")),typeof _._panner.orientationX<"u"?(_._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),_._panner.orientationY.setValueAtTime(a,Howler.ctx.currentTime),_._panner.orientationZ.setValueAtTime(o,Howler.ctx.currentTime)):_._panner.setOrientation(t,a,o)),u._emit("orientation",_._id);else return _._orientation}return u},Howl.prototype.pannerAttr=function(){var t=this,a=arguments,o,l,u;if(!t._webAudio)return t;if(a.length===0)return t._pannerAttr;if(a.length===1)if(typeof a[0]=="object")o=a[0],typeof l>"u"&&(o.pannerAttr||(o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}),t._pannerAttr={coneInnerAngle:typeof o.pannerAttr.coneInnerAngle<"u"?o.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof o.pannerAttr.coneOuterAngle<"u"?o.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof o.pannerAttr.coneOuterGain<"u"?o.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof o.pannerAttr.distanceModel<"u"?o.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof o.pannerAttr.maxDistance<"u"?o.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof o.pannerAttr.refDistance<"u"?o.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof o.pannerAttr.rolloffFactor<"u"?o.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof o.pannerAttr.panningModel<"u"?o.pannerAttr.panningModel:t._panningModel});else return u=t._soundById(parseInt(a[0],10)),u?u._pannerAttr:t._pannerAttr;else a.length===2&&(o=a[0],l=parseInt(a[1],10));for(var p=t._getSoundIds(l),m=0;m<p.length;m++)if(u=t._soundById(p[m]),u){var _=u._pannerAttr;_={coneInnerAngle:typeof o.coneInnerAngle<"u"?o.coneInnerAngle:_.coneInnerAngle,coneOuterAngle:typeof o.coneOuterAngle<"u"?o.coneOuterAngle:_.coneOuterAngle,coneOuterGain:typeof o.coneOuterGain<"u"?o.coneOuterGain:_.coneOuterGain,distanceModel:typeof o.distanceModel<"u"?o.distanceModel:_.distanceModel,maxDistance:typeof o.maxDistance<"u"?o.maxDistance:_.maxDistance,refDistance:typeof o.refDistance<"u"?o.refDistance:_.refDistance,rolloffFactor:typeof o.rolloffFactor<"u"?o.rolloffFactor:_.rolloffFactor,panningModel:typeof o.panningModel<"u"?o.panningModel:_.panningModel};var y=u._panner;y||(u._pos||(u._pos=t._pos||[0,0,-.5]),r(u,"spatial"),y=u._panner),y.coneInnerAngle=_.coneInnerAngle,y.coneOuterAngle=_.coneOuterAngle,y.coneOuterGain=_.coneOuterGain,y.distanceModel=_.distanceModel,y.maxDistance=_.maxDistance,y.refDistance=_.refDistance,y.rolloffFactor=_.rolloffFactor,y.panningModel=_.panningModel}return t},Sound.prototype.init=function(t){return function(){var a=this,o=a._parent;a._orientation=o._orientation,a._stereo=o._stereo,a._pos=o._pos,a._pannerAttr=o._pannerAttr,t.call(this),a._stereo?o.stereo(a._stereo):a._pos&&o.pos(a._pos[0],a._pos[1],a._pos[2],a._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var a=this,o=a._parent;return a._orientation=o._orientation,a._stereo=o._stereo,a._pos=o._pos,a._pannerAttr=o._pannerAttr,a._stereo?o.stereo(a._stereo):a._pos?o.pos(a._pos[0],a._pos[1],a._pos[2],a._id):a._panner&&(a._panner.disconnect(0),a._panner=void 0,o._refreshBuffer(a)),t.call(this)}}(Sound.prototype.reset);var r=function(t,a){a=a||"spatial",a==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()}(Y)),Y}var Dt=Ot();new Dt.Howl({src:["src/assets/adventure.ogg","src/assets/adventure.mp3"],autoplay:!0,loop:!0,volume:.5});let D=[],j=0,Z=0;const Q=async n=>{A.player.position=n.position,D.push(n.symbol),n.remove(),await A.playSound("PICKUP",24)},pe=async n=>{A.player.sprite=`
			........
			........
			..000...
			.0.0.0..
			..000...
			.0.0..0.
			.00000..
			...0....
			`,setTimeout(async()=>{A.playSound("FALL",4),A.end(`%<4>*** GAME OVER! ***<4>%

<5>${n}<5>

 Press SPACE to restart.`)},1e3)},_e=`
  ....4...
  ....4...
  ..5445..
  .564645.
  .5444665
  56656465
  .566565.
  ..5565..
  `,Lt=`
  ...4....
  ...4....
  ..5445..
  .546465.
  5666445.
  56465665
  .565665.
  ..5655..
  `,A=Mt({title:`<7>The Last Mission of
  
INDIANA JONES<7>
  

<5>collect all flags and escape the maze<5>


use arrows to move, press SPACE to continue action
  `,player:{sprite:`
			........
			..999...
			.99999..
			..383..
			..888.8.
			.777777.
			.8.77...
			...77...
			`,position:[1,1]},templates:{x:{solid:!1,sound:["PICKUP",12],sprite:`
        ........
        .933333.
        .93333..
        .9333...
        .93333..
        .933333.
        .9......
        .9......
      `,async onEnter(n){n.remove(),j+=1}},w:{sprite:`
        00000000
        44404440
        00000000
        40444044
        00000000
        44404440
        00000000
        40444044
        
      `},d:{sprite:`
        ........
        ...00...
        ..0660..
        .066660.
        .066660.
        .066600.
        .066660.
        .066660.
      `,async onCollide(n){if(!D.includes("k"))A.playSound("HIT",33),console.log("closed");else if(j<3){A.playSound("HIT",33),A.openMessage(`You have to collect all flags!

Press SPACE to continue`);return}else n.sprite=`
            ........
            ...00...
            ..0330..
            .033330.
            .033330.
            .033330.
            .033330.
            .033330.
          `,setTimeout(async()=>{await A.playSound("PICKUP",3),await A.end(`<7>*** YOU WON !!! ***<7>

Press SPACE to play again.`)},500)}},k:{sprite:`
      ........
      ........
      ....555.
      55555.5.
      5.5.555.
      ........
      ........
      ........  
      `,onCollide(n){Q(n)}},e:{sprite:`
      ........
      ...00...
      ..0.....
      ..200...
      .444.0..
      .444.0..
      .444.0..
      .444.0..
      `,onCollide(n){Q(n)}},f:{sprite:_e,async onCollide(n){D.includes("e")?(await A.playSound("HIT",13),n.sprite=`
            ....4...
            ...34...
            ..3245..
            .323245.
            33333365
            .3232465
            ..33625.
            ....35..
          `,setTimeout(async()=>{n.remove()},1e3)):(await A.playSound("EXPLOSION",18),await pe("You got burned, next time use a fire extinguisher."))},onScreenEnter(n){D=[],j=0,setInterval(()=>{Z=1-Z,n.sprite=Z===0?_e:Lt},300)}},p:{sprite:`
        ........
        ..55555.
        .55555..
        .50005..
        .55555..
        .50055..
        55555...
        ........
      `,async onCollide(){A.playSound("BLIP",1),A.openMessage(`Remember the password:

<3>a3*F<3> 

Press SPACE to close.`)}},g:{sprite:`
        22222222
        22111122
        22101022
        21112112
        21111112
        22111122
        22122122
        21122112
      `,async onCollide(n){await A.prompt("3a*F","a3*F","a3@F","a*F3")===1?(await A.playSound("POWERUP",1),n.remove()):pe("You need to know the right password!")}},c:{sprite:`
        ........
        ..666...
        ..838..2
        ...8...2
        .80008.9
        .8000889
        ..8.8..9
        .88.88.9
      `,async onCollide(n){D.includes("s")?(await A.playSound("HIT",13),n.sprite=`
            ........
            ........
            ........
            ...88.8.
            68.0088.
            63840...
            68.4488.
            ...4448.
          `,setTimeout(async()=>{n.remove()},1e3)):await A.openDialog("^You shall not pass!^")}},s:{sprite:`
        ........
        .....22.
        ....222.
        .7.222..
        ..722...
        ..77...
        .7..7...
        ........
      `,onCollide(n){Q(n)}}},map:`
    wwwwwwww
    w.wxcwdw
    w.pw...w
    w.ww.wsw
    w.f.x.ww
    w.wwwgww
    wewx..kw
    wwwwwwww
	`});
